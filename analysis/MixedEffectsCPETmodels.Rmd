---
title: "MixedEffectsCPETmodels"
author: "nickcoronato"
date: "2021-07-16"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---
```{r options1}
options(max.print=99999)
```

```{r load libraries, echo = FALSE}
# Call the appropriate libraries.
library(tidyverse)
library(plyr)
library(dplyr)
library(splines)
library(boot)
library(broom)
library(lme4)
library(lmerTest)
library(jtools)
library(devtools)
library(lattice)
library(fifer)
library(flexplot)
library(sjPlot)
library(officer)
library(flextable)
library(lsmeans)
library(effects)
library(ggiraph)
library(ggiraphExtra)
library(ggeffects)
library(emmeans)
```

# Data preparation

## Read in the csv of clean data, from this project's "Data" folder.
```{r Read in data, message = FALSE, include = FALSE}
here::i_am("analysis/MixedEffectsCPETmodels.Rmd")
library(here)

all_GK_raw  <-  read_delim(here("data","all_data.csv"),"," ) #This is the raw data set

# This next step divides the full time series for each subject into their 5-10 Exercise and Recovery bouts. Bouts labelled with a ".5" suffix are the recovery (off-transient) bouts.

all_GK_bybout <- mutate(all_GK_raw, 
                        bout =case_when(
  (Time_Sec<120 & Work < 10)~"0",
  (Time_Sec >= 2 & Time_Sec < 175 & Work >=10)~"1",
  (Time_Sec<185 & Work < 10)~"1.5",
  (Time_Sec >= 175 & Time_Sec<300 & Work >=10)~"2",
  (Time_Sec<365 & Work < 10)~"2.5",
  (Time_Sec >= 300 & Time_Sec < 495 & Work >=10)~"3",
  (Time_Sec<545 & Work < 10)~"3.5",
  (Time_Sec >= 495 & Time_Sec <675 & Work >=10)~"4",
  (Time_Sec<725 & Work < 10)~"4.5",
  (Time_Sec >= 675 & Time_Sec <855 & Work >=10)~"5",
  (Time_Sec<905 & Work < 10)~"5.5", 
  (Time_Sec >= 855 & Time_Sec <1035 & Work >= 10)~"6", 
  (Time_Sec<1085 & Work < 10)~"6.5", 
  (Time_Sec >= 1035 & Time_Sec <1215 & Work >= 10)~"7", 
  (Time_Sec<1265 & Work < 10)~"7.5",
  (Time_Sec >= 1215 & Time_Sec <1400 & Work >= 10)~"8", 
  (Time_Sec <1445 & Work < 10)~"8.5",
  (
    # Time_Sec >= 1400 & 
      Time_Sec <1575 & Work >= 10)~"9",
  (
    # Time_Sec >= 1540 & 
     Time_Sec<1625 & Work < 10)~"9.5",
  (Time_Sec >= 1575 & Work >= 10)~"10", 
  (Time_Sec >= 1625 & Work < 10)~"10.5"))

names(all_GK_bybout)[13] <- "Tanner"
# 'Tanner' column is the descriptor for the puberty variable. Early pubertal subjects score 1-2 on the Tanner scale, and late pubertal subjects score 4-5.

# The next step ensures that we have all variables of interest. Note that some are normalized by bodymass (kg) and lean body mass (kg), which are slightly different measurements.
all_GK_bybout <- mutate(all_GK_bybout, "VO2/kglbm"=VO2 / lbm,"VE/VCO2" = (VE / VCO2),"VCO2/kg" =  VCO2/bodymass,"VE/kg" = VE/bodymass, "VCO2/kglbm" =  VCO2/lbm,"VE/kglbm" = VE/lbm)


# All variables should be coded as Factors, with the exception of bout, which is our discrete repeated measure.
all_GK_bybout$Tanner <- as.factor(all_GK_bybout$Tanner)
all_GK_bybout$Gender <- as.factor(all_GK_bybout$Gender)
all_GK_bybout$intensity <- as.factor(all_GK_bybout$intensity)
# all_GK_bybout$bout <- as.factor(all_GK_bybout$bout)
all_GK_bybout$ID <- as.factor(all_GK_bybout$ID)


all_GK_bybout <- all_GK_bybout %>% dplyr::select(ID, bodymass, lbm, intensity, Tanner, Gender, bout, Time_Sec, Work, HR, VO2, 'VO2/kg', 'VO2/kglbm', VCO2, 'VCO2/kg', 'VCO2/kglbm', RQ, VE, 'VE/kg','VE/kglbm', RR, `VE/VCO2`)
all_GK_bybout <- as_tibble(all_GK_bybout)

head(all_GK_bybout,6)

# Check for any NA values in bout column.
(extra_NA <- all_GK_bybout[is.na(all_GK_bybout$bout),])

(summary(all_GK_bybout)) 
```

Create a 'demographics' table for later use, which contains the listing of IDs used in the models.
```{r create demographics}
demographics <- distinct(all_GK_bybout, ID, .keep_all=TRUE)[,1:6]

```


## Convert the 'bout' variable to discrete numeric values. For the off-transient bouts (recovery periods), subtract 1.5 in order to center the variable at 0 for further analysis.
```{r Convert bout var, message=FALSE, warning=FALSE}
ontransbouts <- filter(all_GK_bybout,bout%in%c(0,1,2,3,4,5))
ontransbouts$bout <- as.numeric(ontransbouts$bout)

offtransbouts <- filter(all_GK_bybout,bout%in%c(1.5,2.5,3.5,4.5,5.5,6.5))
offtransbouts$bout <- as.numeric(offtransbouts$bout)
offtransbouts <- mutate(offtransbouts, bout = bout-1.5)
```


## Compute the averages. Pull out the 'avgHR' at each "on-transient" and "off-transient" bout (1-5).
```{r compute avgHR}
avgHRon <- aggregate(ontransbouts$HR, by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgHRon)[6] <- "avgHR"


avgHRoff <- aggregate(offtransbouts$HR, by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgHRoff)[6] <- "avgHR"
```

## Data visualization. Plot the average HR data distributions.
```{r plot avgHR}
# plot the avg ON-transient HR
ggplot(data=avgHRon, aes(bout, avgHR, color = intensity)) + geom_point() + ggtitle("On-Transient average heart rates")

# plot the avg off-transient HR
ggplot(data=avgHRoff, aes(bout, avgHR, color = intensity)) + geom_point()+ ggtitle("Off-Transient average heart rates")

ggplot(data=filter(avgHRon, intensity == "low"), aes(x = bout,y= avgHR, group = ID)) + geom_line() + ggtitle("Low intensity, Avg HR for on-transient periods")+ ylim(80,210) 

ggplot(data=filter(avgHRoff, intensity == "low"), aes(x = bout,y= avgHR, group = ID)) + geom_line() + ggtitle("Low intensity, Avg HR for off-transient periods")+ ylim(80,210)

ggplot(data=filter(avgHRon, intensity == "high"), aes(x = bout,y= avgHR, group = ID)) + geom_line() + ggtitle("High intensity, Avg HR for on-transient periods") + ylim(80,210) 

ggplot(data=filter(avgHRoff, intensity == "high"), aes(x = bout,y= avgHR, group = ID)) + geom_line() + ggtitle("High intensity, Avg HR for off-transient periods") + ylim(80,210)
```

### Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot avgHR}
xyplot(avgHR ~ bout | Gender*Tanner, data = avgHRon, groups = intensity, 
       type = c("p","r"), 
       auto.key = TRUE)

xyplot(avgHR ~ bout | ID, data = avgHRon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgHR ~ bout | ID, data = avgHRon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r boxplot avgHR}
boxplot(avgHR~Gender*Tanner*bout*intensity, data = avgHRon)
```

```{r flexplot avgHR}
### Viewing the categorical variables of interest

# Flexplot of Gender distribution
flexplot(avgHR~Gender, data=avgHRon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgHR~Gender, data=avgHRoff, spread="quartiles", jitter=c(.1, 0))

# Flexplot of Puberty distribution
flexplot(avgHR~Tanner, data=avgHRon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgHR~Tanner, data=avgHRoff, spread="quartiles", jitter=c(.1, 0))


### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgHR~bout + intensity | Gender + Tanner, data=avgHRon, method="lm", se=F, bins=2)

### multivariate relationship (this is more data exploration, prior to the real modeling.)
flexplot(avgHR~bout + intensity | Gender + Tanner, data=avgHRon)
flexplot(avgHR~bout + Gender | intensity + Tanner, data=avgHRon)
flexplot(avgHR~bout + Tanner | intensity + Gender, data=avgHRon)
```


#################################################

# LINEAR MIXED EFFECTS MODELING with the lme4 package
This next section is the full procedure for step-wise variable selection to identify the appropriate mixed-effects model.

In total, there are 14 selected models. Each physiological signal (x7) has two associated models: one linear model is fit to the On-Transient average responses, and a second model is fit to the Off-Transient averages. 

The final multi-level models (MLMs) were chosen through a stepwise variable selection approach that began with the most complex model. Fixed effects considered in the full model were: 
Gender, a factor with two levels (Male, Female); 
Maturational status, a factor with two levels (Early, Late); 
work intensity, a factor with two levels (Low, High); 
and Bout, a continuous predictor in the range of 0 to 5. 

Random slope and intercept were allowed in the bout term for each participant ID in order to account for individual variation between subjects. This controlled for innate differences between subjectsâ€™ physical fitness levels, psychological motivation, and other non-measured variables. If the full model showed insignificance (p-value > 0.05) in the four-way interaction (Gender* Puberty * Intensity * Bout), the model was re-fit with only three-way interactions. 

This stepwise process was repeated, removing higher-level interactions until all fixed effects were statistically significant or no more interactions existed. In order to determine that a simpler model provided better fit than the previous (more complex) model, a standard ANOVA process and Chi-squared comparison was used, as well as a check for reduction in BIC and a Bayes Factor analysis. The simplest possible models used only fixed effects for Gender, Puberty, Intensity, and Bout. However, each of the final 14 models included a unique combination of fixed effects and cross-level interactions that required careful interpretation. Residual plots were analyzed for each final model to confirm an appropriate fit.

The first physiological signal for analysis is Heart Rate (HR).

## HR ON Transient

### Model 1: All interactions

```{r m1 HRon}
m1 <- lmer(avgHR~Gender*Tanner*intensity*bout +(bout|ID), data = avgHRon, REML=FALSE)
# summary(m1)
summ(m1)
# coef(m1)
# fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r m1B HRon}
m1B <- lmer(avgHR~Gender+Tanner*bout * intensity + (bout|ID)  , data = avgHRon, REML=FALSE)
# summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
HRon <- m1B
```


### Comparing On transient models
```{r compare HRon}
improve.fit(m1B,m1)

anova(m1, m1B)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r HRoncoefs}
HRoncoefs <- as_tibble(coef(HRon)$ID)

HRoncoefs <- tibble(demographics, HRoncoefs$bout)

write.csv(HRoncoefs,"~/R/MBEB-CPET/output/HRoncoefs.csv", row.names = TRUE)
```


## HR OFF transient
### Model 2: OFF TRANSIENT: All interactions

```{r m2 HRoff}
m2 <- lmer(avgHR~Gender*Tanner*bout*intensity + (bout|ID)  , data = avgHRoff, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
```


### Model 2B: Some interactions
```{r m2B HRoff}
m2B <- lmer(avgHR~Gender*Tanner*bout + intensity + (bout|ID)  , data = avgHRoff, REML=FALSE)
# summary(m2B)
summ(m2B)
# coef(m2B)
# fixef(m2B)
# ranef(m2B)
```

### Model 2C: Some interactions
```{r m2c HRoff}
m2C <- lmer(avgHR~ bout * intensity + Tanner*intensity + Gender*intensity + (bout|ID)  ,  data = avgHRoff, REML=FALSE)
# summary(m2C)
summ(m2C)
# coef(m2C)
# fixef(m2C)
# ranef(m2C)
HRoff <- m2C
```

### Comparing Off transient models
```{r compare HRoff}
improve.fit(m2B,m2)
improve.fit(m2C,m2B)

anova(m2C, m2B)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r HRoff coefs}
HRoffcoefs <- as_tibble(coef(HRoff)$ID)

HRoffcoefs <- tibble(demographics, HRoffcoefs$bout)

write.csv(HRoffcoefs,"~/R/MBEB-CPET/output/HRoffcoefs.csv", row.names = TRUE)
```

```{r bayes factor HRoff}
# Bayes factor = probability of full model / probability of reduced model - it's an odds. We can approximate BF using BIC:
# in general, BF >10 = strong evidence in favor of the model in the numerator
bf.bic(m2C,m2)
bf.bic(m1B,m1)
```


## VO2/kg On Transient

First, pull out the average on and off transient VO2kg values for each bout.
```{r compute avgVO2}
avgVO2kgon <- aggregate(ontransbouts$'VO2/kg', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVO2kgon)[6] <- "avgVO2kg"

avgVO2kgoff <- aggregate(offtransbouts$'VO2/kg', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVO2kgoff)[6] <- "avgVO2kg"
```


## Plot the average VO2kg data distributions.
```{r plot avgVO2}
#plot the avg ON-transient VO2kg
ggplot(data=avgVO2kgon, aes(bout, avgVO2kg, color = intensity)) + geom_point() + ggtitle("On-Transient average VO2/kg rates")

#plot the avg off-transient VO2kg
ggplot(data=avgVO2kgoff, aes(bout, avgVO2kg, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VO2/kg rates")

ggplot(data=filter(avgVO2kgon, intensity == "low"), aes(x = bout,y= avgVO2kg, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VO2kg for on-transient periods") + ylim(0,75) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVO2kgoff, intensity == "low"), aes(x = bout,y= avgVO2kg, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VO2kg for off-transient periods")+  ylim(0,75) 

ggplot(data=filter(avgVO2kgon, intensity == "high"), aes(x = bout,y= avgVO2kg, group = ID)) + geom_line() + ggtitle("High intensity, Avg VO2kg for on-transient periods")  + ylim(0,75) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVO2kgoff, intensity == "high"), aes(x = bout,y= avgVO2kg, group = ID)) + geom_line() + ggtitle("High intensity, Avg VO2kg for off-transient periods") + ylim(0,75)  
```

## Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot avgVO2}
xyplot(avgVO2kg ~ bout | ID, data = avgVO2kgon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVO2kg ~ bout | ID, data = avgVO2kgon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVO2kg ~ bout | ID, data = avgVO2kgon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

## More visualizations
```{r flexplot avgVO2}
### categorical variable
flexplot(avgVO2kg~Gender, data=avgVO2kgon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVO2kg~Gender, data=avgVO2kgoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVO2kg~Tanner, data=avgVO2kgon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVO2kg~Tanner, data=avgVO2kgoff, spread="quartiles", jitter=c(.1, 0))


### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVO2kg~bout + intensity | Gender + Tanner, data=avgVO2kgon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVO2kg~bout + intensity | Gender + Tanner, data=avgVO2kgon)
flexplot(avgVO2kg~bout + Gender | intensity + Tanner, data=avgVO2kgon)
flexplot(avgVO2kg~bout + Tanner | intensity + Gender, data=avgVO2kgon)
```


### Model 1: All interactions

```{r m1 VO2on}
m1 <- lmer(avgVO2kg~Gender*Tanner*bout*intensity +(bout|ID) , data = avgVO2kgon, REML=FALSE)
# summary(m1)
summ(m1)
# coef(m1)
# fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r m1b vo2on}
m1B <- lmer(avgVO2kg~Gender*Tanner*bout + intensity +(bout|ID) , data = avgVO2kgon, REML=FALSE)
# summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
```

### Model 1C: No interactions

```{r m1c vo2on}
m1C <- lmer(avgVO2kg~ bout*intensity + Gender* intensity + Tanner + (bout|ID) , data = avgVO2kgon, REML=FALSE)
# summary(m1C)
summ(m1C)
# coef(m1C)
# fixef(m1C)
# ranef(m1C)
VO2KGon <- m1C
```



## VO2kg OFF TRANSIENT

### Model 2: All interactions

```{r m2 vo2off}
m2 <- lmer(avgVO2kg~Gender*Tanner*bout*intensity +(bout|ID) ,data = avgVO2kgoff, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
```


### Model 2B: Some interactions
```{r m2b vo2off}
m2B <- lmer(avgVO2kg~Gender*Tanner*bout + intensity +(bout|ID) , data = avgVO2kgoff, REML=FALSE)
# summary(m2B)
summ(m2B)
# coef(m2B)
# fixef(m2B)
# ranef(m2B)
```

### Model 2C: Some interactions
```{r m2c vo2off}
m2C <- lmer(avgVO2kg~ bout*intensity + Gender*intensity + Tanner*intensity + (bout|ID) , data = avgVO2kgoff, REML=FALSE)
# summary(m2C)
summ(m2C)
# coef(m2C)
# # fixef(m2C)
# ranef(m2C)
VO2KGoff <- m2C
```


## VO2/kg LEAN BODY MASS On Transient

First, pull out the average on and off transient VO2kg values for each bout.
```{r compute vo2kglbm avg}
avgVO2kglbmon <- aggregate(ontransbouts$'VO2/kg', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVO2kglbmon)[6] <- "avgVO2kglbm"

avgVO2kglbmoff <- aggregate(offtransbouts$'VO2/kg', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVO2kglbmoff)[6] <- "avgVO2kglbm"
```


## Plot the average VO2kglbm data distributions.
```{r plot vo2kglbm}
#plot the avg ON-transient VO2kglbm
ggplot(data=avgVO2kglbmon, aes(bout, avgVO2kglbm, color = intensity)) + geom_point() + ggtitle("On-Transient average VO2/kg rates")

#plot the avg off-transient VO2kglbm
ggplot(data=avgVO2kglbmoff, aes(bout, avgVO2kglbm, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VO2/kg rates")

ggplot(data=filter(avgVO2kglbmon, intensity == "low"), aes(x = bout,y= avgVO2kglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VO2kglbm for on-transient periods") + ylim(0,75) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVO2kglbmoff, intensity == "low"), aes(x = bout,y= avgVO2kglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VO2kglbm for off-transient periods")+  ylim(0,75) 

ggplot(data=filter(avgVO2kglbmon, intensity == "high"), aes(x = bout,y= avgVO2kglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VO2kglbm for on-transient periods")  + ylim(0,75) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVO2kglbmoff, intensity == "high"), aes(x = bout,y= avgVO2kglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VO2kglbm for off-transient periods") + ylim(0,75)  
```

## Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot vo2kglbm}
xyplot(avgVO2kglbm ~ bout | ID, data = avgVO2kglbmon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVO2kglbm ~ bout | ID, data = avgVO2kglbmon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVO2kglbm ~ bout | ID, data = avgVO2kglbmon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

## More visualizations
```{r flexplot vo2kglbm}
### categorical variable
flexplot(avgVO2kglbm~Gender, data=avgVO2kglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVO2kglbm~Gender, data=avgVO2kglbmoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVO2kglbm~Tanner, data=avgVO2kglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVO2kglbm~Tanner, data=avgVO2kglbmoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVO2kglbm~bout + intensity | Gender + Tanner, data=avgVO2kglbmon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVO2kglbm~bout + intensity | Gender + Tanner, data=avgVO2kglbmon)
flexplot(avgVO2kglbm~bout + Gender | intensity + Tanner, data=avgVO2kglbmon)
flexplot(avgVO2kglbm~bout + Tanner | intensity + Gender, data=avgVO2kglbmon)
```


### Model 1: All interactions

```{r m1 vo2kglbmon}
m1 <- lmer(avgVO2kglbm~Gender*Tanner*bout*intensity +(bout|ID) , data = avgVO2kglbmon, REML=FALSE)
# summary(m1)
summ(m1)
# coef(m1)
# fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r m1b vo2kglbmon}
m1B <- lmer(avgVO2kglbm~Gender*Tanner*bout + intensity +(bout|ID) , data = avgVO2kglbmon, REML=FALSE)
# summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
```

### Model 1C: Some interactions

```{r m1c vo2kglbmon}
m1C <- lmer(avgVO2kglbm~ bout*intensity + Gender* intensity + Tanner + (bout|ID) , data = avgVO2kglbmon, REML=FALSE)
# summary(m1C)
summ(m1C)
# coef(m1C)
# fixef(m1C)
# ranef(m1C)
VO2KGLBMon <- m1C
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r vo2kglbmon coefs}
VO2oncoefs <- as_tibble(coef(VO2KGLBMon)$ID)

VO2oncoefs <- tibble(demographics, VO2oncoefs$bout)

write.csv(VO2oncoefs,"~/R/MBEB-CPET/output/VO2oncoefs.csv", row.names = TRUE)
```

## VO2kglbm OFF TRANSIENT

### Model 2: All interactions

```{r m2 vo2kglbmoff}
m2 <- lmer(avgVO2kglbm~Gender*Tanner*bout*intensity +(bout|ID) ,data = avgVO2kglbmoff, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
```


### Model 2B: Some interactions
```{r m2b vo2kglbmoff}
m2B <- lmer(avgVO2kglbm~Gender*Tanner*bout + intensity +(bout|ID) , data = avgVO2kglbmoff, REML=FALSE)
# summary(m2B)
summ(m2B)
# coef(m2B)
# fixef(m2B)
# ranef(m2B)
```

### Model 2C: Some interactions
```{r m2c vo2kglbmoff}
m2C <- lmer(avgVO2kglbm~ bout*intensity + Gender*intensity + Tanner*intensity + (bout|ID) , data = avgVO2kglbmoff, REML=FALSE)
# summary(m2C)
summ(m2C)
# coef(m2C)
# # fixef(m2C)
# ranef(m2C)
VO2KGLBMoff <- m2C
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r vo2kglbmoff coefs}
VO2offcoefs <- as_tibble(coef(VO2KGLBMoff)$ID)

VO2offcoefs <- tibble(demographics, VO2offcoefs$bout)

write.csv(VO2offcoefs,"~/R/MBEB-CPET/output/VO2offcoefs.csv", row.names = TRUE)
```


# VCO2/kg On Transient

First, pull out the average on and off transient VCO2 values for each bout.
```{r compute VCO2 avgs}
avgVCO2on <- aggregate(ontransbouts$'VCO2/kg', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVCO2on)[6] <- "avgVCO2"

avgVCO2off <- aggregate(offtransbouts$'VCO2/kg', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVCO2off)[6] <- "avgVCO2"
```

##Plot the average VCO2 data distributions.
```{r plot VCO2 }
#plot the avg ON-transient VCO2
ggplot(data=avgVCO2on, aes(bout, avgVCO2, color = intensity)) + geom_point() + ggtitle("On-Transient average VO2/kg rates")

#plot the avg off-transient VCO2
ggplot(data=avgVCO2off, aes(bout, avgVCO2, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VCO2 rates")

ggplot(data=filter(avgVCO2on, intensity == "low"), aes(x = bout,y= avgVCO2, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VCO2 for on-transient periods") + ylim(0,0.2) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVCO2off, intensity == "low"), aes(x = bout,y= avgVCO2, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VCO2 for off-transient periods")+ ylim(0,0.2)

ggplot(data=filter(avgVCO2on, intensity == "high"), aes(x = bout,y= avgVCO2, group = ID)) + geom_line() + ggtitle("High intensity, Avg VCO2 for on-transient periods")  + ylim(0,0.2) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVCO2off, intensity == "high"), aes(x = bout,y= avgVCO2, group = ID)) + geom_line() + ggtitle("High intensity, Avg VCO2 for off-transient periods") + ylim(0,0.2)  
```

##Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot VCO2 }
xyplot(avgVCO2 ~ bout | ID, data = avgVCO2on, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVCO2 ~ bout | ID, data = avgVCO2on, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVCO2 ~ bout | ID, data = avgVCO2on, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r flexplot VCO2}
### categorical variable
flexplot(avgVCO2~Gender, data=avgVCO2on, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVCO2~Gender, data=avgVCO2off, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVCO2~Tanner, data=avgVCO2on, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVCO2~Tanner, data=avgVCO2off, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVCO2~bout + intensity | Gender + Tanner, data=avgVCO2on, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVCO2~bout + intensity | Gender + Tanner, data=avgVCO2on)
flexplot(avgVCO2~bout + Gender | intensity + Tanner, data=avgVCO2on)
flexplot(avgVCO2~bout + Tanner | intensity + Gender, data=avgVCO2on)
```

### Model 1: All interactions

```{r m1 VCO2on}
m1 <- lmer(avgVCO2~bout*intensity*Gender*Tanner +(bout|ID)  , data = avgVCO2on, REML=FALSE)
# summary(m1)
summ(m1)
# coef(m1)
# fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r m1b VCO2on}
m1B <- lmer(avgVCO2~ Gender + Tanner*bout + Tanner*intensity + Gender*intensity + (bout|ID), data = avgVCO2on, REML=FALSE)
# summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
VCO2on <- m1B
```

# VCO2/kg OFF TRANSIENT

### Model 2: All interactions

```{r m2 VCO2off}
m2 <- lmer(avgVCO2~Gender*Tanner*bout*intensity + (bout|ID) , data = avgVCO2off, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
```


### Model 2B: Some interactions
```{r m2b VCO2off}
m2B <- lmer(avgVCO2~Gender * intensity * Tanner + bout +(bout|ID) ,  data = avgVCO2off, REML=FALSE)
# summary(m2B)
summ(m2B)
# coef(m2B)
# fixef(m2B)
# ranef(m2B)
VCO2off <- m2B
```


# VCO2/kg lean body mass On Transient

First, pull out the average on and off transient VCO2kglbm values for each bout.
```{r compute VCO2kglbm avg}
avgVCO2kglbmon <- aggregate(ontransbouts$'VCO2/kglbm', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVCO2kglbmon)[6] <- "avgVCO2kglbm"

avgVCO2kglbmoff <- aggregate(offtransbouts$'VCO2/kglbm', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVCO2kglbmoff)[6] <- "avgVCO2kglbm"
```

##Plot the average VCO2kglbm data distributions.
```{r plot VCO2kglbm}
#plot the avg ON-transient VCO2kglbm
ggplot(data=avgVCO2kglbmon, aes(bout, avgVCO2kglbm, color = intensity)) + geom_point() + ggtitle("On-Transient average VO2/kg rates")

#plot the avg off-transient VCO2kglbm
ggplot(data=avgVCO2kglbmoff, aes(bout, avgVCO2kglbm, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VCO2kglbm rates")

ggplot(data=filter(avgVCO2kglbmon, intensity == "low"), aes(x = bout,y= avgVCO2kglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VCO2kglbm for on-transient periods") + ylim(0,0.2) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVCO2kglbmoff, intensity == "low"), aes(x = bout,y= avgVCO2kglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VCO2kglbm for off-transient periods")+  ylim(0,0.2)

ggplot(data=filter(avgVCO2kglbmon, intensity == "high"), aes(x = bout,y= avgVCO2kglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VCO2kglbm for on-transient periods")  + ylim(0,0.2)
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVCO2kglbmoff, intensity == "high"), aes(x = bout,y= avgVCO2kglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VCO2kglbm for off-transient periods") + ylim(0,0.2)
```

##Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot VCO2kglbm}
xyplot(avgVCO2kglbm ~ bout | ID, data = avgVCO2kglbmon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVCO2kglbm ~ bout | ID, data = avgVCO2kglbmon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVCO2kglbm ~ bout | ID, data = avgVCO2kglbmon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r flexplot VCO2kglbm}
### categorical variable
flexplot(avgVCO2kglbm~Gender, data=avgVCO2kglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVCO2kglbm~Gender, data=avgVCO2kglbmoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVCO2kglbm~Tanner, data=avgVCO2kglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVCO2kglbm~Tanner, data=avgVCO2kglbmoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVCO2kglbm~bout + intensity | Gender + Tanner, data=avgVCO2kglbmon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVCO2kglbm~bout + intensity | Gender + Tanner, data=avgVCO2kglbmon)
flexplot(avgVCO2kglbm~bout + Gender | intensity + Tanner, data=avgVCO2kglbmon)
flexplot(avgVCO2kglbm~bout + Tanner | intensity + Gender, data=avgVCO2kglbmon)
```

### Model 1: All interactions

```{r m1 VCO2kglbmon}
m1 <- lmer(avgVCO2kglbm~bout*intensity*Gender*Tanner +(bout|ID)  , data = avgVCO2kglbmon, REML=FALSE)
# summary(m1)
summ(m1)
# coef(m1)
# fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r m1b VCO2kglbmon}
m1B <- lmer(avgVCO2kglbm~ Gender + Tanner*bout + Tanner*intensity + Gender*intensity + (bout|ID), data = avgVCO2kglbmon, REML=FALSE)
# summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
VCO2kglbmon <- m1B
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r VCO2kglbmon coefs}
VCO2oncoefs <- as_tibble(coef(VCO2on)$ID)

VCO2oncoefs <- tibble(demographics, VCO2oncoefs$bout)

write.csv(VCO2oncoefs,"~/R/MBEB-CPET/output/VCO2oncoefs.csv", row.names = TRUE)
```

# VCO2kglbm OFF TRANSIENT

### Model 2: All interactions

```{r m2 VCO2kglbmoff}
m2 <- lmer(avgVCO2kglbm~Gender*Tanner*bout*intensity + (bout|ID) , data = avgVCO2kglbmoff, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
```


### Model 2B: Some interactions
```{r m2b VCO2kglbmoff}
m2B <- lmer(avgVCO2kglbm~Gender * intensity * Tanner + bout +(bout|ID) ,  data = avgVCO2kglbmoff, REML=FALSE)
# summary(m2B)
summ(m2B)
# coef(m2B)
# fixef(m2B)
# ranef(m2B)
```

### Model 2C: Some interactions
```{r m2c VCO2kglbmoff}
m2C <- lmer(avgVCO2kglbm ~ bout + Gender*intensity +Tanner*intensity + (bout|ID),  data = avgVCO2kglbmoff, REML=FALSE)
# summary(m2C)
summ(m2C)
# coef(m2C)
# fixef(m2C)
# ranef(m2C)
VCO2kglbmoff <- m2C
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r VCO2kglbmoff coefs}
VCO2offcoefs <- as_tibble(coef(VCO2off)$ID)

VCO2offcoefs <- tibble(demographics, VCO2offcoefs$bout)

write.csv(VCO2offcoefs,"~/R/MBEB-CPET/output/VCO2offcoefs.csv", row.names = TRUE)
```

# RQ On Transient

First, pull out the average on and off transient RQ values for each bout.
```{r compute RQ avg}
avgRQon <- aggregate(ontransbouts$RQ, by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgRQon)[6] <- "avgRQ"

avgRQoff <- aggregate(offtransbouts$RQ, by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgRQoff)[6] <- "avgRQ"
```

##Plot the average RQ data distributions.
```{r plot RQ}
#plot the avg ON-transient RQ
ggplot(data=avgRQon, aes(bout, avgRQ, color = intensity)) + geom_point() + ggtitle("On-Transient average RQ rates")

#plot the avg off-transient RQ
ggplot(data=avgRQoff, aes(bout, avgRQ, color = intensity)) + geom_point()+ ggtitle("Off-Transient average RQ rates")

ggplot(data=filter(avgRQon, intensity == "low"), aes(x = bout,y= avgRQ, group = ID)) + geom_line() + ggtitle("Low intensity, Avg RQ for on-transient periods") + ylim(0,2) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgRQoff, intensity == "low"), aes(x = bout,y= avgRQ, group = ID)) + geom_line() + ggtitle("Low intensity, Avg RQ for off-transient periods")+  ylim(0,2) 

ggplot(data=filter(avgRQon, intensity == "high"), aes(x = bout,y= avgRQ, group = ID)) + geom_line() + ggtitle("High intensity, Avg RQ for on-transient periods")  + ylim(0,2) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgRQoff, intensity == "high"), aes(x = bout,y= avgRQ, group = ID)) + geom_line() + ggtitle("High intensity, Avg RQ for off-transient periods") + ylim(0,2)  
```

##Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot RQ}
xyplot(avgRQ ~ bout | ID, data = avgRQon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgRQ ~ bout | ID, data = avgRQon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgRQ ~ bout | ID, data = avgRQon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

## More visualizations
```{r flexplot RQ}
### categorical variable
flexplot(avgRQ~Gender, data=avgRQon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgRQ~Gender, data=avgRQoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgRQ~Tanner, data=avgRQon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgRQ~Tanner, data=avgRQoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgRQ~bout + intensity | Gender + Tanner, data=avgRQon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgRQ~bout + intensity | Gender + Tanner, data=avgRQon)
flexplot(avgRQ~bout + Gender | intensity + Tanner, data=avgRQon)
flexplot(avgRQ~bout + Tanner | intensity + Gender, data=avgRQon)
```

### Model 1: All interactions

```{r m1 RQon}
m1 <- lmer(avgRQ~ bout*Gender*Tanner*intensity + (bout|ID)  , data = avgRQon, REML=FALSE)
# summary(m1)
summ(m1)
# coef(m1)
# # fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r m1B RQon}
m1B <- lmer(avgRQ~ Gender*Tanner*bout + intensity +(bout|ID)  , data = avgRQon, REML=FALSE)
# summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
```

### Model 1C: Some interactions

```{r m1C RQon}
m1C <- lmer(avgRQ~ Tanner*intensity + Gender + bout +(bout|ID)  , data = avgRQon, REML=FALSE)
# summary(m1C)
summ(m1C)
# coef(m1C)
# ranef(m1C)
RQon <- m1C
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r RQon coefs}
RQoncoefs <- as_tibble(coef(RQon)$ID)

RQoncoefs <- tibble(demographics, RQoncoefs$bout)

write.csv(RQoncoefs,"~/R/MBEB-CPET/output/RQoncoefs.csv", row.names = TRUE)
```

# RQ OFF TRANSIENT

### Model 2: All interactions

```{r m2 RQoff}
m2 <- lmer(avgRQ~ bout*Gender*Tanner*intensity +(bout|ID)  , data = avgRQoff, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
```

### Model 2B: Some interactions
```{r m2b RQoff}
m2B <- lmer(avgRQ~Gender*Tanner*bout + intensity +(bout|ID)  ,  data = avgRQoff, REML=FALSE)
# summary(m2B)
summ(m2B)
# coef(m2B)
# # fixef(m2B)
# ranef(m2B)
```

### Model 2C: No interactions
```{r m2c RQoff}
m2C <- lmer(avgRQ~ bout*intensity + Gender*intensity + Tanner*intensity + (bout|ID)  ,  data = avgRQoff, REML=FALSE)
# summary(m2C)
summ(m2C)
# coef(m2C)
# # fixef(m2C)
# ranef(m2C)
RQoff <- m2C
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r RQoff coefs}
RQoffcoefs <- as_tibble(coef(RQoff)$ID)

RQoffcoefs <- tibble(demographics, RQoffcoefs$bout)

write.csv(RQoffcoefs,"~/R/MBEB-CPET/output/RQoffcoefs.csv", row.names = TRUE)
```

# VE/kg On Transient

First, pull out the average on and off transient VE values for each bout.
```{r compute VE avg}
avgVEon <- aggregate(ontransbouts$'VE/kg', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVEon)[6] <- "avgVE"

avgVEoff <- aggregate(offtransbouts$'VE/kg', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVEoff)[6] <- "avgVE"
```

##Plot the average VE data distributions.
```{r plot VE}
#plot the avg ON-transient VE
ggplot(data=avgVEon, aes(bout, avgVE, color = intensity)) + geom_point() + ggtitle("On-Transient average VE rates")

#plot the avg off-transient VE
ggplot(data=avgVEoff, aes(bout, avgVE, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VE rates")

ggplot(data=filter(avgVEon, intensity == "low"), aes(x = bout,y= avgVE, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VE for on-transient periods") + ylim(0,4) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVEoff, intensity == "low"), aes(x = bout,y= avgVE, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VE for off-transient periods")+  ylim(0,4) 

ggplot(data=filter(avgVEon, intensity == "high"), aes(x = bout,y= avgVE, group = ID)) + geom_line() + ggtitle("High intensity, Avg VE for on-transient periods")  + ylim(0,4) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVEoff, intensity == "high"), aes(x = bout,y= avgVE, group = ID)) + geom_line() + ggtitle("High intensity, Avg VE for off-transient periods") + ylim(0,4)  
```

##Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot VE}
xyplot(avgVE ~ bout | ID, data = avgVEon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVE ~ bout | ID, data = avgVEon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVE ~ bout | ID, data = avgVEon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

## More visualizations
```{r flexplot VE}
### categorical variable
flexplot(avgVE~Gender, data=avgVEon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVE~Gender, data=avgVEoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVE~Tanner, data=avgVEon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVE~Tanner, data=avgVEoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVE~bout + intensity | Gender + Tanner, data=avgVEon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVE~bout + intensity | Gender + Tanner, data=avgVEon)
flexplot(avgVE~bout + Gender | intensity + Tanner, data=avgVEon)
flexplot(avgVE~bout + Tanner | intensity + Gender, data=avgVEon)
```

### Model 1: All interactions

```{r m1 VEon}
m1 <- lmer(avgVE~  bout*intensity*Gender*Tanner +(bout|ID)  , data = avgVEon, REML=FALSE)
# summary(m1)
summ(m1)
# coef(m1)
# # fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r m1b VEon}
m1B <- lmer(avgVE~bout + Gender*intensity + Tanner*intensity +(bout|ID)  , data = avgVEon, REML=FALSE)
summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
VEon <- m1B
```


# VE OFF TRANSIENT

### Model 2: All interactions

```{r m2 VEoff}
m2 <- lmer(avgVE~ bout*intensity*Gender*Tanner +(bout|ID) , data = avgVEoff, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
VEoff <- m2
```

# VE/kglbm On Transient

First, pull out the average on and off transient VEkglbm values for each bout.
```{r}
avgVEkglbmon <- aggregate(ontransbouts$'VE/kglbm', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVEkglbmon)[6] <- "avgVEkglbm"

avgVEkglbmoff <- aggregate(offtransbouts$'VE/kglbm', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVEkglbmoff)[6] <- "avgVEkglbm"
```

##Plot the average VEkglbm data distributions.
```{r}
#plot the avg ON-transient VEkglbm
ggplot(data=avgVEkglbmon, aes(bout, avgVEkglbm, color = intensity)) + geom_point() + ggtitle("On-Transient average VEkglbm rates")

#plot the avg off-transient VEkglbm
ggplot(data=avgVEkglbmoff, aes(bout, avgVEkglbm, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VEkglbm rates")

ggplot(data=filter(avgVEkglbmon, intensity == "low"), aes(x = bout,y= avgVEkglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VEkglbm for on-transient periods") + ylim(0,5) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVEkglbmoff, intensity == "low"), aes(x = bout,y= avgVEkglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VEkglbm for off-transient periods")+  ylim(0,5)  

ggplot(data=filter(avgVEkglbmon, intensity == "high"), aes(x = bout,y= avgVEkglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VEkglbm for on-transient periods")  + ylim(0,5)  
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVEkglbmoff, intensity == "high"), aes(x = bout,y= avgVEkglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VEkglbm for off-transient periods") + ylim(0,5) 
```

##Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r}
xyplot(avgVEkglbm ~ bout | ID, data = avgVEkglbmon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVEkglbm ~ bout | ID, data = avgVEkglbmon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVEkglbm ~ bout | ID, data = avgVEkglbmon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

## More visualizations
```{r}
### categorical variable
flexplot(avgVEkglbm~Gender, data=avgVEkglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVEkglbm~Gender, data=avgVEkglbmoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVEkglbm~Tanner, data=avgVEkglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVEkglbm~Tanner, data=avgVEkglbmoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVEkglbm~bout + intensity | Gender + Tanner, data=avgVEkglbmon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVEkglbm~bout + intensity | Gender + Tanner, data=avgVEkglbmon)
flexplot(avgVEkglbm~bout + Gender | intensity + Tanner, data=avgVEkglbmon)
flexplot(avgVEkglbm~bout + Tanner | intensity + Gender, data=avgVEkglbmon)
```

### Model 1: All interactions

```{r}
m1 <- lmer(avgVEkglbm~  bout*intensity*Gender*Tanner +(bout|ID)  , data = avgVEkglbmon, REML=FALSE)
summary(m1)
summ(m1)
# coef(m1)
# # fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r}
m1B <- lmer(avgVEkglbm~bout + Gender + Tanner*intensity +(bout|ID)  , data = avgVEkglbmon, REML=TRUE)
# summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
VEkglbmon <- m1B
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
VEoncoefs <- as_tibble(coef(VEon)$ID)

VEoncoefs <- tibble(demographics, VEoncoefs$bout)

write.csv(VEoncoefs,"~/R/MBEB-CPET/output/VEoncoefs.csv", row.names = TRUE)
```

## VEkglbm OFF TRANSIENT

### Model 2: All interactions

```{r}
m2 <- lmer(avgVEkglbm~ bout*intensity*Gender*Tanner +(bout|ID) , data = avgVEkglbmoff, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
```


### Model 2B: Some interactions
```{r}
m2B <- lmer(avgVEkglbm~Gender*Tanner*bout+intensity +(bout|ID) , data = avgVEkglbmoff, REML=FALSE)
# summary(m2B)
summ(m2B)
# coef(m2B)
# # fixef(m2B)
# ranef(m2B)
```

### Model 2C: Some interactions
```{r}
m2C <- lmer(avgVEkglbm~Gender*intensity + bout*intensity + Tanner*intensity +(bout|ID) , data = avgVEkglbmoff, REML=FALSE)
# summary(m2C)
summ(m2C)
# coef(m2C)
# # fixef(m2C)
# ranef(m2C)
VEkglbmoff <- m2C
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
VEoffcoefs <- as_tibble(coef(VEoff)$ID)

VEoffcoefs <- tibble(demographics, VEoffcoefs$bout)

write.csv(VEoffcoefs,"~/R/MBEB-CPET/output/VEoffcoefs.csv", row.names = TRUE)
```

##  RR On Transient

First, pull out the average on and off transient RR values for each bout.
```{r}
avgRRon <- aggregate(ontransbouts$RR, by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgRRon)[6] <- "avgRR"

avgRRoff <- aggregate(offtransbouts$RR, by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgRRoff)[6] <- "avgRR"
```

###Plot the average RR data distributions.
```{r}
#plot the avg ON-transient RR
ggplot(data=avgRRon, aes(bout, avgRR, color = intensity)) + geom_point() + ggtitle("On-Transient average RR rates")

#plot the avg off-transient RR
ggplot(data=avgRRoff, aes(bout, avgRR, color = intensity)) + geom_point()+ ggtitle("Off-Transient average RR rates")

ggplot(data=filter(avgRRon, intensity == "low"), aes(x = bout,y= avgRR, group = ID)) + geom_line() + ggtitle("Low intensity, Avg RR for on-transient periods") + ylim(0,80) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgRRoff, intensity == "low"), aes(x = bout,y= avgRR, group = ID)) + geom_line() + ggtitle("Low intensity, Avg RR for off-transient periods")+  ylim(0,80) 

ggplot(data=filter(avgRRon, intensity == "high"), aes(x = bout,y= avgRR, group = ID)) + geom_line() + ggtitle("High intensity, Avg RR for on-transient periods")  + ylim(0,80) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgRRoff, intensity == "high"), aes(x = bout,y= avgRR, group = ID)) + geom_line() + ggtitle("High intensity, Avg RR for off-transient periods") + ylim(0,80)  
```

###Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r}
xyplot(avgRR ~ bout | ID, data = avgRRon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgRR ~ bout | ID, data = avgRRon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgRR ~ bout | ID, data = avgRRon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r}
### categorical variable
flexplot(avgRR~Gender, data=avgRRon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgRR~Gender, data=avgRRoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgRR~Tanner, data=avgRRon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgRR~Tanner, data=avgRRoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remoRR standard errors, and specify 2 bins
flexplot(avgRR~bout + intensity | Gender + Tanner, data=avgRRon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgRR~bout + intensity | Gender + Tanner, data=avgRRon)
flexplot(avgRR~bout + Gender | intensity + Tanner, data=avgRRon)
flexplot(avgRR~bout + Tanner | intensity + Gender, data=avgRRon)
```

### Model 1: All interactions

```{r}
m1 <- lmer(avgRR~Gender*Tanner*bout*intensity +(bout|ID)  , data = avgRRon, REML=FALSE)
# summary(m1)
summ(m1)
# coef(m1)
# fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r}
m1B <- lmer(avgRR~Gender*Tanner*bout + intensity +(bout|ID)  , data = avgRRon, REML=FALSE)
# summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
```

### Model 1C: Some interactions

```{r}
m1C <- lmer(avgRR~ bout*intensity + Tanner + Gender  + (bout|ID)  , data = avgRRon, REML=FALSE)
# summary(m1C)
summ(m1C)
# coef(m1C)
# ranef(m1C)
RRon <- m1C
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
RRoncoefs <- as_tibble(coef(RRon)$ID)

RRoncoefs <- tibble(demographics, RRoncoefs$bout)

write.csv(RRoncoefs,"~/R/MBEB-CPET/output/RRoncoefs.csv", row.names = TRUE)
```

## RR OFF TRANSIENT

### Model 2: All interactions

```{r}
m2 <- lmer(avgRR~Gender*Tanner*bout*intensity +(bout|ID) , data = avgRRoff, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
```


### Model 2B: Some interactions
```{r}
m2B <- lmer(avgRR~ bout*intensity + Gender*Tanner*bout + (bout|ID) , data = avgRRoff, REML=FALSE)
# summary(m2B)
summ(m2B)
# coef(m2B)
# # fixef(m2B)
# ranef(m2B)
RRoff <- m2B
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
RRoffcoefs <- as_tibble(coef(RRoff)$ID)

RRoffcoefs <- tibble(demographics, RRoffcoefs$bout)

write.csv(RRoffcoefs,"~/R/MBEB-CPET/output/RRoffcoefs.csv", row.names = TRUE)
```

# VE/VCO2 ratio

##  VE.VCO2 On Transient

First, pull out the average on and off transient VE.VCO2 values for each bout.
```{r}
avgVE.VCO2on <- aggregate(ontransbouts$'VE/VCO2', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVE.VCO2on)[6] <- "avgVE.VCO2"

avgVE.VCO2off <- aggregate(offtransbouts$'VE/VCO2', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVE.VCO2off)[6] <- "avgVE.VCO2"
```

##Plot the average VE/VCO2 data distributions.
```{r}
#plot the avg ON-transient VE/VCO2
ggplot(data=avgVE.VCO2on, aes(bout, avgVE.VCO2, color = intensity)) + geom_point() + ggtitle("On-Transient average VE/VCO2 rates")

#plot the avg off-transient VE/VCO2
ggplot(data=avgVE.VCO2off, aes(bout, avgVE.VCO2, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VE/VCO2 rates")

ggplot(data=filter(avgVE.VCO2on, intensity == "low"), aes(x = bout,y= avgVE.VCO2, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VE/VCO2 for on-transient periods")+ ylim(20,80)
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVE.VCO2off, intensity == "low"), aes(x = bout,y= avgVE.VCO2, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VE/VCO2 for off-transient periods")+ ylim(20,80)

ggplot(data=filter(avgVE.VCO2on, intensity == "high"), aes(x = bout,y= avgVE.VCO2, group = ID)) + geom_line() + ggtitle("High intensity, Avg VE/VCO2 for on-transient periods")+ ylim(20,80)
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVE.VCO2off, intensity == "high"), aes(x = bout,y= avgVE.VCO2, group = ID)) + geom_line() + ggtitle("High intensity, Avg VE/VCO2 for off-transient periods") + ylim(20,80)
```

##Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r}
xyplot(avgVE.VCO2 ~ bout | ID, data = avgVE.VCO2on, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVE.VCO2 ~ bout | ID, data = avgVE.VCO2on, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVE.VCO2 ~ bout | ID, data = avgVE.VCO2on, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

## More visualizations
```{r}
### categorical variable
flexplot(avgVE.VCO2~Gender, data=avgVE.VCO2on, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVE.VCO2~Gender, data=avgVE.VCO2off, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVE.VCO2~Tanner, data=avgVE.VCO2on, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVE.VCO2~Tanner, data=avgVE.VCO2off, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVE.VCO2~bout + intensity | Gender + Tanner, data=avgVE.VCO2on, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVE.VCO2~bout + intensity | Gender + Tanner, data=avgVE.VCO2on)
flexplot(avgVE.VCO2~bout + Gender | intensity + Tanner, data=avgVE.VCO2on)
flexplot(avgVE.VCO2~bout + Tanner | intensity + Gender, data=avgVE.VCO2on)
```

### Model 1: All interactions

```{r}
m1 <- lmer(avgVE.VCO2~Gender*Tanner*bout*intensity +(bout|ID)  , data = avgVE.VCO2on, REML=FALSE)
# summary(m1)
summ(m1)
# coef(m1)
# fixef(m1)
# ranef(m1)
```

### Model 1B: Some interactions

```{r}
m1B <- lmer(avgVE.VCO2~Gender*Tanner*bout + intensity +(bout|ID)  , data = avgVE.VCO2on, REML=FALSE)
# summary(m1B)
summ(m1B)
# coef(m1B)
# ranef(m1B)
```

### Model 1C: Some interactions

```{r}
m1C <- lmer(avgVE.VCO2~ bout*intensity + Tanner*intensity + Gender  + (bout|ID)  , data = avgVE.VCO2on, REML=FALSE)
# summary(m1C)
summ(m1C)
# coef(m1C)
# ranef(m1C)
VE.VCO2on <- m1C
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
VE.VCO2oncoefs <- as_tibble(coef(VE.VCO2on)$ID)

VE.VCO2oncoefs <- tibble(demographics, VE.VCO2oncoefs$bout)

write.csv(VE.VCO2oncoefs,"~/R/MBEB-CPET/output/VE.VCO2oncoefs.csv", row.names = TRUE)
```

## VE.VCO2 OFF TRANSIENT

### Model 2: All interactions

```{r}
m2 <- lmer(avgVE.VCO2~Gender*Tanner*bout*intensity +(bout|ID) , data = avgVE.VCO2off, REML=FALSE)
# summary(m2)
summ(m2)
# coef(m2)
# ranef(m2)
```


### Model 2B: Some interactions
```{r}
m2B <- lmer(avgVE.VCO2~ bout*Gender*Tanner + intensity + (bout|ID) , data = avgVE.VCO2off, REML=FALSE)
# summary(m2B)
summ(m2B)
# coef(m2B)
# # fixef(m2B)
# ranef(m2B)
```

### Model 2C: Some interactions
```{r}
m2C <- lmer(avgVE.VCO2~ bout + Gender + Tanner* intensity + (bout|ID) , data = avgVE.VCO2off, REML=TRUE)
# summary(m2C)
summ(m2C)
# coef(m2C)
# # fixef(m2C)
# ranef(m2C)
VE.VCO2off <- m2C
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
VE.VCO2offcoefs <- as_tibble(coef(VE.VCO2off)$ID)

VE.VCO2offcoefs <- tibble(demographics, VE.VCO2offcoefs$bout)

write.csv(VE.VCO2offcoefs,"~/R/MBEB-CPET/output/VE.VCO2offcoefs.csv", row.names = TRUE)
```

# Predicted Values

## Predict and visualize the linear models.

```{r}
# Another way to do this is with plot_model:  
# plot_model(HRon, type = "pred", terms = c("bout", "Tanner", "intensity"))

dat.HRon <- ggpredict(HRon, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.HRon,"~/R/MBEB-CPET/output/dat.HRon.csv", row.names = FALSE)
plot(dat.HRon)

dat.HRoff <- ggpredict(HRoff, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.HRoff,"~/R/MBEB-CPET/output/dat.HRoff.csv", row.names = FALSE)
plot(dat.HRoff)

dat.VO2KGon <- ggpredict(VO2KGon, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VO2KGon,"~/R/MBEB-CPET/output/dat.VO2KGon.csv", row.names = FALSE)
plot(dat.VO2KGon)

dat.VO2KGoff <- ggpredict(VO2KGoff, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VO2KGoff,"~/R/MBEB-CPET/output/dat.VO2KGoff.csv", row.names = FALSE)
plot(dat.VO2KGoff)

dat.VO2KGLBMon <- ggpredict(VO2KGLBMon, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VO2KGLBMon,"~/R/MBEB-CPET/output/dat.VO2KGLBMon.csv", row.names = FALSE)
plot(dat.VO2KGLBMon)

dat.VO2KGLBMoff <- ggpredict(VO2KGLBMoff, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VO2KGLBMoff,"~/R/MBEB-CPET/output/dat.VO2KGLBMoff.csv", row.names = FALSE)
plot(dat.VO2KGLBMoff)

dat.VCO2on <- ggpredict(VCO2on, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VCO2on,"~/R/MBEB-CPET/output/dat.VCO2on.csv", row.names = FALSE)
plot(dat.VCO2on)

dat.VCO2off <- ggpredict(VCO2off, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VCO2off,"~/R/MBEB-CPET/output/dat.VCO2off.csv", row.names = FALSE)
plot(dat.VCO2off)

dat.VCO2kglbmon <- ggpredict(VCO2kglbmon, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VCO2kglbmon,"~/R/MBEB-CPET/output/dat.VCO2kglbmon.csv", row.names = FALSE)
plot(dat.VCO2kglbmon)

dat.VCO2kglbmoff <- ggpredict(VCO2kglbmoff, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VCO2kglbmoff,"~/R/MBEB-CPET/output/dat.VCO2kglbmoff.csv", row.names = FALSE)
plot(dat.VCO2kglbmoff)

dat.RQon <- ggpredict(RQon, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.RQon,"~/R/MBEB-CPET/output/dat.RQon.csv", row.names = FALSE)
plot(dat.RQon)

dat.RQoff <- ggpredict(RQoff, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.RQoff,"~/R/MBEB-CPET/output/dat.RQoff.csv", row.names = FALSE)
plot(dat.RQoff)

dat.VEkglbmon <- ggpredict(VEkglbmon, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VEkglbmon,"~/R/MBEB-CPET/output/dat.VEkglbmon.csv", row.names = FALSE)
plot(dat.VEkglbmon)

dat.VEkglbmon <- ggpredict(VEkglbmon, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VEkglbmon,"~/R/MBEB-CPET/output/dat.VEkglbmon.csv", row.names = FALSE)
plot(dat.VEkglbmon)

dat.VEkglbmoff <- ggpredict(VEkglbmoff, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VEkglbmoff,"~/R/MBEB-CPET/output/dat.VEkglbmoff.csv", row.names = FALSE)
plot(dat.VEkglbmoff)

dat.RRon <- ggpredict(RRon, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.RRon,"~/R/MBEB-CPET/output/dat.RRon.csv", row.names = FALSE)
plot(dat.RRon)

dat.RRoff <- ggpredict(RRoff, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.RRoff,"~/R/MBEB-CPET/output/dat.RRoff.csv", row.names = FALSE)
plot(dat.RRoff)

dat.VE.VCO2on <- ggpredict(VE.VCO2on, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VE.VCO2on,"~/R/MBEB-CPET/output/dat.VE.VCO2on.csv", row.names = FALSE)
plot(dat.VE.VCO2on)

dat.VE.VCO2off <- ggpredict(VE.VCO2off, terms = c("bout","Gender", "Tanner", "intensity"))
write.csv(dat.VE.VCO2off,"~/R/MBEB-CPET/output/dat.VE.VCO2off.csv", row.names = FALSE)
plot(dat.VE.VCO2off)

```

```{r}
names(dat.HRon)[6:8] <- c("Gender", "Tanner", "intensity")
names(dat.HRon)[1:2] <- c("x","avgHR")

dat.HRon$x <- as.factor(dat.HRon$x)

# Facet_grid allows us to see a different dot plot for each group's summary stats
ggplot(dat.HRon, aes(x, avgHR)) + geom_point(aes(shape = Tanner))+
  geom_errorbar(
    aes(ymin = conf.low, ymax = conf.high
        , color = Gender
        ),
    position = position_dodge(0.2), width = 0.2
  ) + facet_grid(Gender~Tanner~intensity) +labs(title="Predicted Average HR at each bout",x="bout", y = "Average HR") +theme_bw()
```

```{r}
plot_summs(VCO2on, VCO2off, scale = TRUE, 
           # inner_ci_level = .95, 
           plot.distributions = F)
```

# Printing the model results as tables
## Tab_model version

 Adjust file name in the tab_model function to specify html save location.
```{r}
allmodels <- c(HRon, HRoff, VO2KGLBMon,VO2KGLBMoff, VCO2kglbmon,VCO2kglbmoff,RQon,RQoff,VEkglbmon,VEkglbmoff,RRon,RRoff,VE.VCO2on, VE.VCO2off)

tab_model(allmodels, 
          show.reflvl = F, 
          auto.label=TRUE, 
          dv.labels = c("HR (on)", "HR (off)", "VO2/kg (on)", "VO2/kg (off)", "VCO2/kg (on)", "VCO2/kg (off)", "RQ (on)", "RQ (off)", "VE/kg (on)", "VE/kg (off)", "RR (on)", "RR (off)", "VE/VCO2 (on)", "VE/VCO2 (off)"),
          CSS = css_theme("cells")
          # ,file = "C:/Users/__.html"
          )
```

## Individual tab_models
```{r}
HRmodels <- c(HRon, HRoff)
tab_model(HRmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("HR (exercise)", "HR (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/HRmodels.html"
          )

# VO2KGmodels <- c(VO2KGon, VO2KGoff)
# tab_model(VO2KGmodels, show.reflvl = F, auto.label=TRUE 
#           # ,prefix.labels ="varname"
#           , dv.labels = c("VO2/kg (exercise)", "VO2/kg (rest)")
#           , CSS = css_theme("cells")
#           ,file = "~/R/MBEB-CPET/output/HRmodels.html"
#           )

VO2KGLBMmodels <- c(VO2KGLBMon, VO2KGLBMoff)
tab_model(VO2KGLBMmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("VO2/kg (exercise)", "VO2/kg (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/VO2models.html"
          )

# VCO2models <- c(VCO2on, VCO2off)
# tab_model(VCO2models, show.reflvl = F, auto.label=TRUE 
#           # ,prefix.labels ="varname"
#           , dv.labels = c("VCO2 (exercise)", "VCO2 (rest)")
#           , CSS = css_theme("cells")
#           ,file = "~/R/MBEB-CPET/output/HRmodels.html"
#           )

VCO2kglbmmodels <- c(VCO2kglbmon, VCO2kglbmoff)
tab_model(VCO2kglbmmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("VCO2/kg (exercise)", "VCO2/kg (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/VCO2models.html"
          )

RQmodels <- c(RQon, RQoff)
tab_model(RQmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("RQ (exercise)", "RQ (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/RQmodels.html"
          )

# VEmodels <- c(VEon, VEoff)
# tab_model(VEmodels, show.reflvl = F, auto.label=TRUE 
#           # ,prefix.labels ="varname"
#           , dv.labels = c("VE (exercise)", "VE (rest)")
#           , CSS = css_theme("cells")
#           ,file = "~/R/MBEB-CPET/output/VEmodels.html"
#           )

VEkglbmmodels <- c(VEkglbmon, VEkglbmoff)
tab_model(VEkglbmmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("VE/kg (exercise)", "VE/kg (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/VEmodels.html"
          )

RRmodels <- c(RRon, RRoff)
tab_model(RRmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("RR (exercise)", "RR (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/RRmodels.html"
          )

VE.VCO2models <- c(VE.VCO2on, VE.VCO2off)
tab_model(VE.VCO2models, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("VE/VCO2 (exercise)", "VE/VCO2 (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/VE.VCO2models.html"
          )
```



# residuals analysis
Generate a histogram of the residuals for each model against its original data.
```{r}
HRonresiduals <- resid(HRon)
summary(HRonresiduals)
hist(HRonresiduals)
print(dotplot(ranef(HRon,condVar=TRUE)))
plot(HRon)
```
```{r}
HRoffresiduals <- resid(HRoff)
summary(HRoffresiduals)
hist(HRoffresiduals)
print(dotplot(ranef(HRoff,condVar=TRUE)))
```
```{r}
VO2KGLBMonresiduals <- resid(VO2KGLBMon)
summary(VO2KGLBMonresiduals)
hist(VO2KGLBMonresiduals)
print(dotplot(ranef(VO2KGLBMon,condVar=TRUE)))
```
```{r}
VO2KGLBMoffresiduals <- resid(VO2KGLBMoff)
summary(VO2KGLBMoffresiduals)
hist(VO2KGLBMoffresiduals)
print(dotplot(ranef(VO2KGLBMoff,condVar=TRUE)))
```
```{r}
VCO2kglbmonresiduals <- resid(VCO2kglbmon)
summary(VCO2kglbmonresiduals)
hist(VCO2kglbmonresiduals)
print(dotplot(ranef(VCO2kglbmon,condVar=TRUE)))
```
```{r}
VCO2kglbmoffresiduals <- resid(VCO2kglbmoff)
summary(VCO2kglbmoffresiduals)
hist(VCO2kglbmoffresiduals)
print(dotplot(ranef(VCO2kglbmoff,condVar=TRUE)))
```
```{r}
VEkglbmonresiduals <- resid(VEkglbmon)
summary(VEkglbmonresiduals)
hist(VEkglbmonresiduals)
print(dotplot(ranef(VEkglbmon,condVar=TRUE)))
```
```{r}
VEkglbmoffresiduals <- resid(VEkglbmoff)
summary(VEkglbmoffresiduals)
hist(VEkglbmoffresiduals)
print(dotplot(ranef(VEkglbmoff,condVar=TRUE)))
```
```{r}
RQonresiduals <- resid(RQon)
summary(RQonresiduals)
hist(RQonresiduals)
print(dotplot(ranef(RQon,condVar=TRUE)))
```
```{r}
RQoffresiduals <- resid(RQoff)
summary(RQoffresiduals)
hist(RQoffresiduals)
print(dotplot(ranef(RQoff,condVar=TRUE)))
```
```{r}
RRonresiduals <- resid(RRon)
summary(RRonresiduals)
hist(RRonresiduals)
print(dotplot(ranef(RRon,condVar=TRUE)))
```
```{r}
RRoffresiduals <- resid(RRoff)
summary(RRoffresiduals)
hist(RRoffresiduals)
print(dotplot(ranef(RRoff,condVar=TRUE)))
```
```{r}
VE.VCO2onresiduals <- resid(VE.VCO2on)
summary(VE.VCO2onresiduals)
hist(VE.VCO2onresiduals)
print(dotplot(ranef(VE.VCO2on,condVar=TRUE)))
```
```{r}
VE.VCO2offresiduals <- resid(VE.VCO2off)
plot(resid(VE.VCO2off))
summary(VE.VCO2offresiduals)
hist(VE.VCO2offresiduals)
print(dotplot(ranef(VE.VCO2off,condVar=TRUE)))
```

# Time Constant comparisons
This section generates plots of marginal means for the response variable, based on the mixed effects models generated above. 
The plots show the relationship between the response variable and the Time Constant (calculated via optimization in separate code) for each bout in the sequence.
There is a plot for each CPET variable, except Respiratory QUotient, which provided non-useful results in the Time Constant optimization.
The Time constant is considered as the variable 'tau' in the best-fit exponential model in the on- and off-transient bouts.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries 2, include = FALSE}
# Call the appropriate libraries.
library(tidyverse)
library(plotrix)
library(dplyr)
library(plyr)
```

## Data preparation


### Function to compute mean and standard error for each group.

```{r SummarySE function}
## Summarizes data.
## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,
                      conf.interval=.95, .drop=TRUE) {
    library(plyr)

    # New version of length which can handle NA's: if na.rm==T, don't count them
    length2 <- function (x, na.rm=FALSE) {
        if (na.rm) sum(!is.na(x))
        else       length(x)
    }

    # This does the summary. For each group's data frame, return a vector with
    # N, mean, and sd
    datac <- ddply(data, groupvars, .drop=.drop,
      .fun = function(xx, col) {
        c(N    = length2(xx[[col]], na.rm=na.rm),
          mean = mean   (xx[[col]], na.rm=na.rm),
          sd   = sd     (xx[[col]], na.rm=na.rm)
        )
      },
      measurevar
    )

    # Rename the "mean" column    
    datac <- rename(datac, c("mean" = measurevar))

    datac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean

    # Confidence interval multiplier for standard error
    # Calculate t-statistic for confidence interval: 
    # e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
    ciMult <- qt(conf.interval/2 + .5, datac$N-1)
    datac$ci <- datac$se * ciMult

    return(datac)
}
```

## Read in csv
Read in csv files for predicted points (from MixedEffectsCPETmodels.Rmd) and Tau values (separate .csv files).
```{r, message = FALSE}
here::i_am("analysis/Time Constant comparisons v2.Rmd")
library(here)

dat.HRon <- readr::read_csv(
  here("output","dat.HRon.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.HRoff <- readr::read_csv(
  here("output","dat.HRoff.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.RQon <- readr::read_csv(
  here("output","dat.RQon.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.RQoff <- readr::read_csv(
  here("output","dat.RQoff.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.RRon <- readr::read_csv(
  here("output","dat.RRon.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.RRoff <- readr::read_csv(
  here("output","dat.RRoff.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.VCO2on <- readr::read_csv(
  here("output","dat.VCO2kglbmon.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.VCO2off <- readr::read_csv(
  here("output","dat.VCO2kglbmoff.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.VO2off <- readr::read_csv(
  here("output","dat.VO2KGLBMoff.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.VO2on <- readr::read_csv(
  here("output","dat.VO2KGLBMon.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))

dat.VEoff <- readr::read_csv(
  here("output","dat.VEkglbmoff.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
dat.VEon <- readr::read_csv(
  here("output","dat.VEkglbmon.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
```

```{r, message = FALSE}
here::i_am("analysis/Time Constant comparisons v2.Rmd")
library(here)

HR_on_tau <- readr::read_csv(
  here("data","avg_HR_on.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
HR_off_tau <- readr::read_csv(
  here("data","avg_HR_off.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
# tau.RQon <- readr::read_csv(
#   here("data","avg_RQ_on.csv"
#        # ,
#   # col_types = list(.default = readr::col_guess())
# ))
# tau.RQoff <- readr::read_csv(
#   here("data","avg_RQ_off.csv"
#        # ,
#   # col_types = list(.default = readr::col_guess())
# ))
RR_on_tau <- readr::read_csv(
  here("data","avg_RR_on.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
RR_off_tau <- readr::read_csv(
  here("data","avg_RR_off.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
VCO2_on_tau <- readr::read_csv(
  here("data","avg_VCO2_on.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
VCO2_off_tau <- readr::read_csv(
  here("data","avg_VCO2_off.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
VO2_off_tau <- readr::read_csv(
  here("data","avg_VO2_off.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
VO2_on_tau <- readr::read_csv(
  here("data","avg_VO2_on.csv"
))

VE_on_tau <- readr::read_csv(
  here("data","avg_VE_on.csv"
       # ,
  # col_types = list(.default = readr::col_guess())
))
VE_off_tau <- readr::read_csv(
  here("data","avg_VE_off.csv"
))


```

##VCO2 on
Rearrange the data into long format, with mean and standard error calculations for each group (GenderxTannerxIntensity).
```{r}
CPET <- "VCO2_on_"

# VCO2_on <- filter(myfiles, set == "VCO2_on")

bout1 <- summarySE(VCO2_on_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(VCO2_on_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(VCO2_on_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(VCO2_on_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(VCO2_on_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

VCO2_on_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(VCO2_on_tau)[2] <- "group"

```



Combine the dataframes for predicted points (regression model) and Tau values (exponential model).

```{r}
# combine the two DFs
library(dplyr)
new.dat.VCO2.on <- filter(dat.VCO2on, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
  
names(new.dat.VCO2.on)[1] <- "bout"
# names(new.dat.VCO2.on)[2] <- "value"
new.dat.VCO2.on <- new.dat.VCO2.on[,c(6,7,8,1,2,3)]
names(new.dat.VCO2.on)[1:3] <- c("group","facet","panel")

new.dat.VCO2.on <- arrange(new.dat.VCO2.on,bout,group,facet,panel)

VCO2_on_tau <- arrange(VCO2_on_tau,bout,group,facet,panel)
VCO2_on_tau <- mutate(VCO2_on_tau, bout = as.numeric(bout))

combined.VCO2.on <- tibble(new.dat.VCO2.on[,1:6],VCO2_on_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.VCO2.on <- split(combined.VCO2.on, with(combined.VCO2.on, interaction(group,facet,panel)), drop = TRUE)

split.VCO2.on[[1]] -> FEMALE.early.high
split.VCO2.on[[5]] -> FEMALE.early.low
split.VCO2.on[[3]] -> FEMALE.late.high
split.VCO2.on[[7]] -> FEMALE.late.low

split.VCO2.on[[2]] -> MALE.early.high
split.VCO2.on[[6]] -> MALE.early.low
split.VCO2.on[[4]] -> MALE.late.high
split.VCO2.on[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.

#### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg"))
       , width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 on-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

#### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 on-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

#### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 on-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

#### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 on-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

###Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

#### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 on-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

#### Male Late Low
```{r}
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

#### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 on-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

##VCO2 off
```{r}
CPET <- "VCO2_off_"

# VCO2_off <- filter(myfiles, set == "VCO2_off")

bout1 <- summarySE(VCO2_off_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(VCO2_off_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(VCO2_off_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(VCO2_off_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(VCO2_off_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

VCO2_off_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(VCO2_off_tau)[2] <- "group"

```

Combine the dataframes for predicted points (regression model) and Tau values (exponential model).
```{r}
# combine the two DFs
library(dplyr)
new.dat.VCO2.off <- filter(dat.VCO2off, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
  
names(new.dat.VCO2.off)[1] <- "bout"
# names(new.dat.VCO2.off)[2] <- "value"
new.dat.VCO2.off <- new.dat.VCO2.off[,c(6,7,8,1,2,3)]
names(new.dat.VCO2.off)[1:3] <- c("group","facet","panel")

new.dat.VCO2.off <- arrange(new.dat.VCO2.off,bout,group,facet,panel)

VCO2_off_tau <- arrange(VCO2_off_tau,bout,group,facet,panel)
VCO2_off_tau <- mutate(VCO2_off_tau, bout = as.numeric(bout))

combined.VCO2.off <- tibble(new.dat.VCO2.off[,1:6],VCO2_off_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.VCO2.off <- split(combined.VCO2.off, with(combined.VCO2.off, interaction(group,facet,panel)), drop = TRUE)

split.VCO2.off[[1]] -> FEMALE.early.high
split.VCO2.off[[5]] -> FEMALE.early.low
split.VCO2.off[[3]] -> FEMALE.late.high
split.VCO2.off[[7]] -> FEMALE.late.low

split.VCO2.off[[2]] -> MALE.early.high
split.VCO2.off[[6]] -> MALE.early.low
split.VCO2.off[[4]] -> MALE.late.high
split.VCO2.off[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.


### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 off-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 off-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 off-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 off-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 off-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 off-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late Low
```{r}
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 off-transient - Late Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VCO2 off-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VCO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VCO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

##HR on
Rearrange the data into long format, with mean and standard error calculations for each group (GenderxTannerxIntensity).
```{r}
CPET <- "HR_on_"

# HR_on <- filter(myfiles, set == "HR_on")

bout1 <- summarySE(HR_on_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(HR_on_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(HR_on_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(HR_on_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(HR_on_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

HR_on_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(HR_on_tau)[2] <- "group"

```

Combine the dataframes for predicted points (regression model) and Tau values (exponential model).
```{r}
# combine the two DFs
library(dplyr)
new.dat.HR.on <- filter(dat.HRon, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
names(new.dat.HR.on)[1] <- "bout"
new.dat.HR.on <- mutate(new.dat.HR.on, bout = as.numeric(bout))
  

# names(new.dat.HR.on)[2] <- "value"
new.dat.HR.on <- new.dat.HR.on[,c(6,7,8,1,2,3)]
names(new.dat.HR.on)[1:3] <- c("group","facet","panel")

new.dat.HR.on <- arrange(new.dat.HR.on,bout,group,facet,panel)


HR_on_tau <- arrange(HR_on_tau,bout,group,facet,panel)
HR_on_tau <- mutate(HR_on_tau, bout = as.numeric(bout))

combined.HR.on <- tibble(new.dat.HR.on[,1:6],HR_on_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.HR.on <- split(combined.HR.on, with(combined.HR.on, interaction(group,facet,panel)), drop = TRUE)

split.HR.on[[1]] -> FEMALE.early.high
split.HR.on[[5]] -> FEMALE.early.low
split.HR.on[[3]] -> FEMALE.late.high
split.HR.on[[7]] -> FEMALE.late.low

split.HR.on[[2]] -> MALE.early.high
split.HR.on[[6]] -> MALE.early.low
split.HR.on[[4]] -> MALE.late.high
split.HR.on[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.

### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR on-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR on-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR on-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR on-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)
## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR on-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late Low
```{r}
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR on-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

##HR off
```{r}
CPET <- "HR_off_"

# HR_off <- filter(myfiles, set == "HR_off")

bout1 <- summarySE(HR_off_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(HR_off_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(HR_off_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(HR_off_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(HR_off_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

HR_off_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(HR_off_tau)[2] <- "group"

```

Combine the dataframes for predicted points (regression model) and Tau values (exponential model).
```{r}
# combine the two DFs
library(dplyr)
new.dat.HR.off <- filter(dat.HRoff, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
names(new.dat.HR.off)[1] <- "bout"
new.dat.HR.off <- mutate(new.dat.HR.off, bout = as.numeric(bout))
  

# names(new.dat.HR.off)[2] <- "value"
new.dat.HR.off <- new.dat.HR.off[,c(6,7,8,1,2,3)]
names(new.dat.HR.off)[1:3] <- c("group","facet","panel")

new.dat.HR.off <- arrange(new.dat.HR.off,bout,group,facet,panel)


HR_off_tau <- arrange(HR_off_tau,bout,group,facet,panel)
HR_off_tau <- mutate(HR_off_tau, bout = as.numeric(bout))

combined.HR.off <- tibble(new.dat.HR.off[,1:6],HR_off_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.HR.off <- split(combined.HR.off, with(combined.HR.off, interaction(group,facet,panel)), drop = TRUE)

split.HR.off[[1]] -> FEMALE.early.high
split.HR.off[[5]] -> FEMALE.early.low
split.HR.off[[3]] -> FEMALE.late.high
split.HR.off[[7]] -> FEMALE.late.low

split.HR.off[[2]] -> MALE.early.high
split.HR.off[[6]] -> MALE.early.low
split.HR.off[[4]] -> MALE.late.high
split.HR.off[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.


### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR off-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR off-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR off-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR off-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR off-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR off-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late Low
```{r}
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR off-transient - Late Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="HR off-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean HR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean HR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

##RR on
Rearrange the data into long format, with mean and standard error calculations for each group (GenderxTannerxIntensity).
```{r}
CPET <- "RR_on_"

# RR_on <- filter(myfiles, set == "RR_on")

bout1 <- summarySE(RR_on_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(RR_on_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(RR_on_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(RR_on_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(RR_on_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

RR_on_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(RR_on_tau)[2] <- "group"

```

Combine the dataframes for predicted points (regression model) and Tau values (exponential model).
```{r}
# combine the two DFs
library(dplyr)
new.dat.RR.on <- filter(dat.RRon, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
  
names(new.dat.RR.on)[1] <- "bout"
# names(new.dat.RR.on)[2] <- "value"
new.dat.RR.on <- new.dat.RR.on[,c(6,7,8,1,2,3)]
names(new.dat.RR.on)[1:3] <- c("group","facet","panel")

new.dat.RR.on <- arrange(new.dat.RR.on,bout,group,facet,panel)

RR_on_tau <- arrange(RR_on_tau,bout,group,facet,panel)
RR_on_tau <- mutate(RR_on_tau, bout = as.numeric(bout))

combined.RR.on <- tibble(new.dat.RR.on[,1:6],RR_on_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.RR.on <- split(combined.RR.on, with(combined.RR.on, interaction(group,facet,panel)), drop = TRUE)

split.RR.on[[1]] -> FEMALE.early.high
split.RR.on[[5]] -> FEMALE.early.low
split.RR.on[[3]] -> FEMALE.late.high
split.RR.on[[7]] -> FEMALE.late.low

split.RR.on[[2]] -> MALE.early.high
split.RR.on[[6]] -> MALE.early.low
split.RR.on[[4]] -> MALE.late.high
split.RR.on[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.

### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR on-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR on-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR on-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR on-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR on-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late Low
```{r}
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR on-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

##RR off
```{r}
CPET <- "RR_off_"

# RR_off <- filter(myfiles, set == "RR_off")

bout1 <- summarySE(RR_off_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(RR_off_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(RR_off_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(RR_off_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(RR_off_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

RR_off_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(RR_off_tau)[2] <- "group"

```
Combine the dataframes for predicted points (regression model) and Tau values (exponential model).
```{r}
# combine the two DFs
library(dplyr)
new.dat.RR.off <- filter(dat.RRoff, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
  
names(new.dat.RR.off)[1] <- "bout"
# names(new.dat.RR.off)[2] <- "value"
new.dat.RR.off <- new.dat.RR.off[,c(6,7,8,1,2,3)]
names(new.dat.RR.off)[1:3] <- c("group","facet","panel")

new.dat.RR.off <- arrange(new.dat.RR.off,bout,group,facet,panel)

RR_off_tau <- arrange(RR_off_tau,bout,group,facet,panel)
RR_off_tau <- mutate(RR_off_tau, bout = as.numeric(bout))

combined.RR.off <- tibble(new.dat.RR.off[,1:6],RR_off_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.RR.off <- split(combined.RR.off, with(combined.RR.off, interaction(group,facet,panel)), drop = TRUE)

split.RR.off[[1]] -> FEMALE.early.high
split.RR.off[[5]] -> FEMALE.early.low
split.RR.off[[3]] -> FEMALE.late.high
split.RR.off[[7]] -> FEMALE.late.low

split.RR.off[[2]] -> MALE.early.high
split.RR.off[[6]] -> MALE.early.low
split.RR.off[[4]] -> MALE.late.high
split.RR.off[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.


### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR off-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR off-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR off-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR off-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR off-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR off-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late Low
```{r}
# Set the min and max values for the x- and y-axes in our plots.
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR off-transient - Late Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="RR off-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean RR",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean RR","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

##VE on
Rearrange the data into long format, with mean and standard error calculations for each group (GenderxTannerxIntensity).
```{r}
CPET <- "VE_on_"

# VE_on <- filter(myfiles, set == "VE_on")

bout1 <- summarySE(VE_on_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(VE_on_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(VE_on_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(VE_on_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(VE_on_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

VE_on_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(VE_on_tau)[2] <- "group"

```
Combine the dataframes for predicted points (regression model) and Tau values (exponential model).
```{r}
# combine the two DFs
library(dplyr)
new.dat.VE.on <- filter(dat.VEon, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
  
names(new.dat.VE.on)[1] <- "bout"
# names(new.dat.VE.on)[2] <- "value"
new.dat.VE.on <- new.dat.VE.on[,c(6,7,8,1,2,3)]
names(new.dat.VE.on)[1:3] <- c("group","facet","panel")

new.dat.VE.on <- arrange(new.dat.VE.on,bout,group,facet,panel)

VE_on_tau <- arrange(VE_on_tau,bout,group,facet,panel)
VE_on_tau <- mutate(VE_on_tau, bout = as.numeric(bout))

combined.VE.on <- tibble(new.dat.VE.on[,1:6],VE_on_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.VE.on <- split(combined.VE.on, with(combined.VE.on, interaction(group,facet,panel)), drop = TRUE)

split.VE.on[[1]] -> FEMALE.early.high
split.VE.on[[5]] -> FEMALE.early.low
split.VE.on[[3]] -> FEMALE.late.high
split.VE.on[[7]] -> FEMALE.late.low

split.VE.on[[2]] -> MALE.early.high
split.VE.on[[6]] -> MALE.early.low
split.VE.on[[4]] -> MALE.late.high
split.VE.on[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.

### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE on-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE on-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE on-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE on-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE on-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late Low
```{r}
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE on-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

##VE off
```{r}
CPET <- "VE_off_"

# VE_off <- filter(myfiles, set == "VE_off")

bout1 <- summarySE(VE_off_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(VE_off_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(VE_off_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(VE_off_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(VE_off_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

VE_off_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(VE_off_tau)[2] <- "group"

```
Combine the dataframes for predicted points (regression model) and Tau values (exponential model).
```{r}
# combine the two DFs
library(dplyr)
new.dat.VE.off <- filter(dat.VEoff, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
  
names(new.dat.VE.off)[1] <- "bout"
# names(new.dat.VE.off)[2] <- "value"
new.dat.VE.off <- new.dat.VE.off[,c(6,7,8,1,2,3)]
names(new.dat.VE.off)[1:3] <- c("group","facet","panel")

new.dat.VE.off <- arrange(new.dat.VE.off,bout,group,facet,panel)

VE_off_tau <- arrange(VE_off_tau,bout,group,facet,panel)
VE_off_tau <- mutate(VE_off_tau, bout = as.numeric(bout))

combined.VE.off <- tibble(new.dat.VE.off[,1:6],VE_off_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.VE.off <- split(combined.VE.off, with(combined.VE.off, interaction(group,facet,panel)), drop = TRUE)

split.VE.off[[1]] -> FEMALE.early.high
split.VE.off[[5]] -> FEMALE.early.low
split.VE.off[[3]] -> FEMALE.late.high
split.VE.off[[7]] -> FEMALE.late.low

split.VE.off[[2]] -> MALE.early.high
split.VE.off[[6]] -> MALE.early.low
split.VE.off[[4]] -> MALE.late.high
split.VE.off[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.


### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE off-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE off-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE off-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE off-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE off-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE off-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late Low
```{r}
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE off-transient - Late Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VE off-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VE",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VE","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

##VO2 on
Rearrange the data into long format, with mean and standard error calculations for each group (GenderxTannerxIntensity).
```{r}
CPET <- "VO2_on_"

# VO2_on <- filter(myfiles, set == "VO2_on")

bout1 <- summarySE(VO2_on_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(VO2_on_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(VO2_on_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(VO2_on_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(VO2_on_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

VO2_on_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(VO2_on_tau)[2] <- "group"

```
Combine the dataframes for predicted points (regression model) and Tau values (exponential model).
```{r}
# combine the two DFs
library(dplyr)
new.dat.VO2.on <- filter(dat.VO2on, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
  
names(new.dat.VO2.on)[1] <- "bout"
# names(new.dat.VO2.on)[2] <- "value"
new.dat.VO2.on <- new.dat.VO2.on[,c(6,7,8,1,2,3)]
names(new.dat.VO2.on)[1:3] <- c("group","facet","panel")

new.dat.VO2.on <- arrange(new.dat.VO2.on,bout,group,facet,panel)

VO2_on_tau <- arrange(VO2_on_tau,bout,group,facet,panel)
VO2_on_tau <- mutate(VO2_on_tau, bout = as.numeric(bout))

combined.VO2.on <- tibble(new.dat.VO2.on[,1:6],VO2_on_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.VO2.on <- split(combined.VO2.on, with(combined.VO2.on, interaction(group,facet,panel)), drop = TRUE)

split.VO2.on[[1]] -> FEMALE.early.high
split.VO2.on[[5]] -> FEMALE.early.low
split.VO2.on[[3]] -> FEMALE.late.high
split.VO2.on[[7]] -> FEMALE.late.low

split.VO2.on[[2]] -> MALE.early.high
split.VO2.on[[6]] -> MALE.early.low
split.VO2.on[[4]] -> MALE.late.high
split.VO2.on[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.

### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 on-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 on-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 on-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 on-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 on-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late Low
```{r}
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 on-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 on-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

##VO2 off
```{r}
CPET <- "VO2_off_"

# VO2_off <- filter(myfiles, set == "VO2_off")

bout1 <- summarySE(VO2_off_tau, measurevar="bout1", groupvars = c("group",'facet','panel'))
bout1 <- bout1[,c(1,2,3,5,7)] 
# %>% mutate(bout = 1)
names(bout1)[4] <- "value"

bout2 <- summarySE(VO2_off_tau, measurevar="bout2", groupvars = c("group",'facet','panel'))
bout2 <- bout2[,c(1,2,3,5,7)]
# %>% mutate(bout = 2)
names(bout2)[4] <- "value"

bout3 <- summarySE(VO2_off_tau, measurevar="bout3", groupvars = c("group",'facet','panel'))
bout3 <- bout3[,c(1,2,3,5,7)]
# %>% mutate(bout = 3)
names(bout3)[4] <- "value"

bout4 <- summarySE(VO2_off_tau, measurevar="bout4", groupvars = c("group",'facet','panel'))
bout4 <- bout4[,c(1,2,3,5,7)]
# %>% mutate(bout = 4)
names(bout4)[4] <- "value"

bout5 <- summarySE(VO2_off_tau, measurevar="bout5", groupvars = c("group",'facet','panel'))
bout5 <- bout5[,c(1,2,3,5,7)]
# %>% mutate(bout = 5)
names(bout5)[4] <- "value"

VO2_off_tau <- bind_rows(list(bout1, bout2, bout3, bout4, bout5), .id="bout") 
names(VO2_off_tau)[2] <- "group"

```
Combine the dataframes for predicted points (regression model) and Tau values (exponential model).
```{r}
# combine the two DFs
library(dplyr)
new.dat.VO2.off <- filter(dat.VO2off, x != 0
                          # , group %in% 'FEMALE', facet%in% "Early", panel%in% "high"
                          )
  
names(new.dat.VO2.off)[1] <- "bout"
# names(new.dat.VO2.off)[2] <- "value"
new.dat.VO2.off <- new.dat.VO2.off[,c(6,7,8,1,2,3)]
names(new.dat.VO2.off)[1:3] <- c("group","facet","panel")

new.dat.VO2.off <- arrange(new.dat.VO2.off,bout,group,facet,panel)

VO2_off_tau <- arrange(VO2_off_tau,bout,group,facet,panel)
VO2_off_tau <- mutate(VO2_off_tau, bout = as.numeric(bout))

combined.VO2.off <- tibble(new.dat.VO2.off[,1:6],VO2_off_tau[,5:6])
```


Separate the combined DF into each group (Gender x Tanner x Intensity).
```{r}
split.VO2.off <- split(combined.VO2.off, with(combined.VO2.off, interaction(group,facet,panel)), drop = TRUE)

split.VO2.off[[1]] -> FEMALE.early.high
split.VO2.off[[5]] -> FEMALE.early.low
split.VO2.off[[3]] -> FEMALE.late.high
split.VO2.off[[7]] -> FEMALE.late.low

split.VO2.off[[2]] -> MALE.early.high
split.VO2.off[[6]] -> MALE.early.low
split.VO2.off[[4]] -> MALE.late.high
split.VO2.off[[8]] -> MALE.late.low
```

The eight code chunks below generate a separate plot for each subject group.


### Female Early High
```{r}
grouping <- "FEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.high$predicted)-max(FEMALE.early.high$std.error))
maxyleft <- 1.1*(max(FEMALE.early.high$predicted)+max(FEMALE.early.high$std.error))
minyright <- .9*(min(FEMALE.early.high$value)-max(FEMALE.early.high$se))
maxyright <-1.1*(max(FEMALE.early.high$value)+max(FEMALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.high$bout, FEMALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 off-transient - Early Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$predicted+(FEMALE.early.high$std.error), y1=FEMALE.early.high$predicted-(FEMALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.high$bout, y=FEMALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.high$bout, y0=FEMALE.early.high$value+(FEMALE.early.high$se), y1=FEMALE.early.high$value-(FEMALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Early Low
```{r}
grouping <- "FEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.early.low$predicted)-max(FEMALE.early.low$std.error))
maxyleft <- 1.1*(max(FEMALE.early.low$predicted)+max(FEMALE.early.low$std.error))
minyright <- .9*(min(FEMALE.early.low$value)-max(FEMALE.early.low$se))
maxyright <-1.1*(max(FEMALE.early.low$value)+max(FEMALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.early.low$bout, FEMALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 off-transient - Early Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$predicted+(FEMALE.early.low$std.error), y1=FEMALE.early.low$predicted-(FEMALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.early.low$bout, y=FEMALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.early.low$bout, y0=FEMALE.early.low$value+(FEMALE.early.low$se), y1=FEMALE.early.low$value-(FEMALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late Low
```{r}
grouping <- "FLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.low$predicted)-max(FEMALE.late.low$std.error))
maxyleft <- 1.1*(max(FEMALE.late.low$predicted)+max(FEMALE.late.low$std.error))
minyright <- .9*(min(FEMALE.late.low$value)-max(FEMALE.late.low$se))
maxyright <-1.1*(max(FEMALE.late.low$value)+max(FEMALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.low$bout, FEMALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 off-transient - Late Puberty Female, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$predicted+(FEMALE.late.low$std.error), y1=FEMALE.late.low$predicted-(FEMALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.low$bout, y=FEMALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.low$bout, y0=FEMALE.late.low$value+(FEMALE.late.low$se), y1=FEMALE.late.low$value-(FEMALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Female Late High
```{r}
grouping <- "FLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(FEMALE.late.high$predicted)-max(FEMALE.late.high$std.error))
maxyleft <- 1.1*(max(FEMALE.late.high$predicted)+max(FEMALE.late.high$std.error))
minyright <- .9*(min(FEMALE.late.high$value)-max(FEMALE.late.high$se))
maxyright <-1.1*(max(FEMALE.late.high$value)+max(FEMALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(FEMALE.late.high$bout, FEMALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 off-transient - Late Puberty Female, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$predicted+(FEMALE.late.high$std.error), y1=FEMALE.late.high$predicted-(FEMALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=FEMALE.late.high$bout, y=FEMALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(FEMALE.late.high$bout, y0=FEMALE.late.high$value+(FEMALE.late.high$se), y1=FEMALE.late.high$value-(FEMALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(FEMALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early High
```{r}
grouping <- "MEH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.high$predicted)-max(MALE.early.high$std.error))
maxyleft <- 1.1*(max(MALE.early.high$predicted)+max(MALE.early.high$std.error))
minyright <- .9*(min(MALE.early.high$value)-max(MALE.early.high$se))
maxyright <-1.1*(max(MALE.early.high$value)+max(MALE.early.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.high$bout, MALE.early.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 off-transient - Early Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.high$bout, y0=MALE.early.high$predicted+(MALE.early.high$std.error), y1=MALE.early.high$predicted-(MALE.early.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.high$bout, y=MALE.early.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.high$bout, y0=MALE.early.high$value+(MALE.early.high$se), y1=MALE.early.high$value-(MALE.early.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Early Low
```{r}
grouping <- "MEL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.early.low$predicted)-max(MALE.early.low$std.error))
maxyleft <- 1.1*(max(MALE.early.low$predicted)+max(MALE.early.low$std.error))
minyright <- .9*(min(MALE.early.low$value)-max(MALE.early.low$se))
maxyright <-1.1*(max(MALE.early.low$value)+max(MALE.early.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.early.low$bout, MALE.early.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 off-transient - Early Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.early.low$bout, y0=MALE.early.low$predicted+(MALE.early.low$std.error), y1=MALE.early.low$predicted-(MALE.early.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.early.low$bout, y=MALE.early.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.early.low$bout, y0=MALE.early.low$value+(MALE.early.low$se), y1=MALE.early.low$value-(MALE.early.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.early.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late Low
```{r}
grouping <- "MLL"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.low$predicted)-max(MALE.late.low$std.error))
maxyleft <- 1.1*(max(MALE.late.low$predicted)+max(MALE.late.low$std.error))
minyright <- .9*(min(MALE.late.low$value)-max(MALE.late.low$se))
maxyright <-1.1*(max(MALE.late.low$value)+max(MALE.late.low$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.low$bout, MALE.late.low$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 off-transient - Late Puberty Male, Low Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.low$bout, y0=MALE.late.low$predicted+(MALE.late.low$std.error), y1=MALE.late.low$predicted-(MALE.late.low$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.low$bout, y=MALE.late.low$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.low$bout, y0=MALE.late.low$value+(MALE.late.low$se), y1=MALE.late.low$value-(MALE.late.low$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.low$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```

### Male Late High
```{r}
grouping <- "MLH"

# Set the min and max values for the x- and y-axes in our plots.
minyleft <- .9*(min(MALE.late.high$predicted)-max(MALE.late.high$std.error))
maxyleft <- 1.1*(max(MALE.late.high$predicted)+max(MALE.late.high$std.error))
minyright <- .9*(min(MALE.late.high$value)-max(MALE.late.high$se))
maxyright <-1.1*(max(MALE.late.high$value)+max(MALE.late.high$se))

#save the plot
jpeg(file= here("output/plots",paste0(CPET,grouping,".jpeg")), width = 800, height = 500)

## add extra space to right margin of plot within frame
par(mar=c(5, 4, 4, 6) + 0.1)

## Plot first set of data and draw its axis
plot(MALE.late.high$bout, MALE.late.high$predicted, 
     xlim = c(0,5), ylim = c(minyleft,maxyleft)
   , pch=16, axes=FALSE, xlab="", ylab="",
   type="p",col="black", main="VO2 off-transient - Late Puberty Male, High Intensity"
      )

# axis generation
axis(2, ylim=c(0.02,.06), col="black", las=1)  ## las=1 makes horizontal labels
mtext("Mean VO2",side=2,line=3.2)
box()
# standard error bars for the predicted values
arrows(MALE.late.high$bout, y0=MALE.late.high$predicted+(MALE.late.high$std.error), y1=MALE.late.high$predicted-(MALE.late.high$std.error),
       length = 0.05, angle = 90, code = 3)

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(x=MALE.late.high$bout, y=MALE.late.high$value
     , pch=15,  xlab="", ylab="", ylim=c(minyright,maxyright), xlim = c(0,5),
    axes=FALSE, type="p", col="red" )
# standard error bars for the Tau values
arrows(MALE.late.high$bout, y0=MALE.late.high$value+(MALE.late.high$se), y1=MALE.late.high$value-(MALE.late.high$se),
       length = 0.05, angle = 90, code = 3, col="red")

## a little farther out (line=3) to make room for labels
mtext("Time Constant (tau)",side=4,col="red",line=3) 
axis(4, ylim=c(100,190), col="red",col.axis="red",las=1)

## Draw the time axis (bouts 1-5)
axis(1,pretty(range(MALE.late.high$bout),5))
mtext("Bout",side=1,col="black",line=2.5)  

## Add Legend
legend("topleft",legend=c("Predicted Mean VO2","Time Constant"),
  text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

dev.off()
```


#Post-hoc comparisons of means

## HRon Nested data

A factor A is nested in another factor B if the levels of A have a different meaning in one level of B than in another. Often, nested factors are random effectsâ€”for example, subjects in an experiment may be randomly assigned to treatments, in which case subjects are nested in treatmentsâ€”and if we model them as random effects, these random nested effects are not among the fixed effects and are not an issue to emmeans. But sometimes we have fixed nested factors.

For our post-hoc comparisons, we ensure that 'bout' is modeled as a factor which will enable mean comparisons between levels of 'bout'.

```{r}
# avgHRon$bout <- as.numeric(avgHRon$bout)
avgHRon$bout <- as.factor(avgHRon$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

HRon <- lmer(avgHR~Gender+Tanner*bout * intensity + (bout|ID)  , data = avgHRon, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
HRon.emm <- emmeans(HRon, ~ bout |intensity*Gender*Tanner)
HRon.emm
```
It might be nice to extract these estimates and plot them:

```{r}
HRon.emm.df <-
  HRon.emm %>%
  broom::tidy()

HRon.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response")
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(HRon.emm, "poly", max.degree = 2)
```



### Marginal Mean Change comparisons
Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
HRon %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout.  
```{r}
HRon %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
HRonpairs <- pairs(HRon.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(HRonpairs)
```

```{r}
HRon.rg <- ref_grid(HRon
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(HRon.rg)                    
HRon.rg
```

### Graphs with nesting

```{r}
plot(HRon.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(HRon.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.

To visualize the lines themselves:
```{r}
emmip(HRon, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(HRon, group = "bout",slope = TRUE, id = TRUE)
```


## HRoff Nested data

```{r}
# avgHRoff$bout <- as.numeric(avgHRoff$bout)
avgHRoff$bout <- as.factor(avgHRoff$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

HRoff <- lmer(avgHR~ bout * intensity + Tanner*intensity + Gender*intensity + (bout|ID)  ,  data = avgHRoff, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
HRoff.emm <- emmeans(HRoff, ~ bout |intensity*Gender*Tanner)
HRoff.emm
```

It might be nice to extract these estimates and plot them:
```{r}
HRoff.emm.df <-
  HRoff.emm %>%
  broom::tidy()

HRoff.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response") 
```

### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(HRoff.emm, "poly", max.degree = 2, adjustment = 'tukey')
```

### Marginal Mean Change comparisons

Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).
 
```{r}
HRoff %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout.  
```{r}
HRoff %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
HRoffpairs <- pairs(HRoff.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(HRoffpairs)
```

```{r}
HRoff.rg <- ref_grid(HRoff
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(HRoff.rg)                    
HRoff.rg
```

### Graphs with nesting
```{r}
plot(HRoff.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(HRoff.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor. 

To visualize the lines themselves:

```{r}
emmip(HRoff, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package

```{r}
library(predictmeans)
residplot(HRoff, group = "bout",slope = TRUE, id = TRUE)
```

## VO2on Nested data

For our post-hoc comparisons, we ensure that 'bout' is modeled as a factor which will enable mean comparisons between levels of 'bout'.

```{r}
# avgVO2kglbmon$bout <- as.numeric(avgVO2kglbmon$bout)
avgVO2kglbmon$bout <- as.factor(avgVO2kglbmon$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

VO2on <- lmer(avgVO2kglbm~ bout*intensity + Gender* intensity + Tanner + (bout|ID) , data = avgVO2kglbmon, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
VO2on.emm <- emmeans(VO2on, ~ bout |intensity*Gender*Tanner)
VO2on.emm
```
It might be nice to extract these estimates and plot them:

```{r}
VO2on.emm.df <-
  VO2on.emm %>%
  broom::tidy()

VO2on.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response")
```

### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(VO2on.emm, "poly", max.degree = 2)
```

### Marginal Mean Change comparisons
Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

```{r}
VO2on %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for VO2 on transient.
```{r}
VO2on %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
VO2onpairs <- pairs(VO2on.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(VO2onpairs)
```

```{r}
VO2on.rg <- ref_grid(VO2on
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(VO2on.rg)                    
VO2on.rg
```
### Graphs with nesting
```{r}
plot(VO2on.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(VO2on.emm))
```

### Interactions with covariates

To visualize the lines themselves:

```{r}
emmip(VO2on, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(VO2on, group = "bout",slope = TRUE, id = TRUE)
```

## VO2off Nested data

```{r}
# avgVO2kglbmoff$bout <- as.numeric(avgVO2kglbmoff$bout)
avgVO2kglbmoff$bout <- as.factor(avgVO2kglbmoff$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

VO2off <- lmer(avgVO2kglbm~ bout*intensity + Gender*intensity + Tanner*intensity + (bout|ID) , data = avgVO2kglbmoff, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
VO2off.emm <- emmeans(VO2off, ~ bout |intensity*Gender*Tanner)
VO2off.emm
```
It might be nice to extract these estimates and plot them:

```{r}
VO2off.emm.df <-
  VO2off.emm %>%
  broom::tidy()

VO2off.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response") 
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(VO2off.emm, "poly", max.degree = 2, adjustment = 'tukey')
```



### Marginal Mean Change comparisons

Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
VO2off %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for VO2 on transient.
```{r}
VO2off %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
VO2offpairs <- pairs(VO2off.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(VO2offpairs)
```



```{r}
VO2off.rg <- ref_grid(VO2off
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(VO2off.rg)                    
VO2off.rg
```

### Graphs with nesting
```{r}
plot(VO2off.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(VO2off.emm))
```

### Interactions with covariates
To visualize the lines themselves:

```{r}
emmip(VO2off, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(VO2off, group = "bout",slope = TRUE, id = TRUE)
```
## VCO2on Nested data

For our post-hoc comparisons, we ensure that 'bout' is modeled as a factor which will enable mean comparisons between levels of 'bout'.

```{r}
# avgVCO2kglbmon$bout <- as.numeric(avgVCO2kglbmon$bout)
avgVCO2kglbmon$bout <- as.factor(avgVCO2kglbmon$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

VCO2on <- lmer(avgVCO2kglbm~ Gender + Tanner*bout + Tanner*intensity + Gender*intensity + (bout|ID), data = avgVCO2kglbmon, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
VCO2on.emm <- emmeans(VCO2on, ~ bout |intensity*Gender*Tanner)
VCO2on.emm
```
It might be nice to extract these estimates and plot them:

```{r}
VCO2on.emm.df <-
  VCO2on.emm %>%
  broom::tidy()

VCO2on.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response")
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(VCO2on.emm, "poly", max.degree = 2)
```



### Marginal Mean Change comparisons
Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
VCO2on %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for VCO2 on transient.
```{r}
VCO2on %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r paged.print=TRUE}
VCO2onpairs <- pairs(VCO2on.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(VCO2onpairs)
```
```{r}
VCO2on.rg <- ref_grid(VCO2on
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(VCO2on.rg)                    
VCO2on.rg
```

### Graphs with nesting

```{r}
plot(VCO2on.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(VCO2on.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(VCO2on, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(VCO2on, group = "bout",slope = TRUE, id = TRUE)
```
## VCO2off Nested data

```{r}
# avgVCO2kglbmoff$bout <- as.numeric(avgVCO2kglbmoff$bout)
avgVCO2kglbmoff$bout <- as.factor(avgVCO2kglbmoff$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

VCO2off <- lmer(avgVCO2kglbm ~ bout + Gender*intensity +Tanner*intensity + (bout|ID),  data = avgVCO2kglbmoff, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
VCO2off.emm <- emmeans(VCO2off, ~ bout |intensity*Gender*Tanner)
VCO2off.emm
```
It might be nice to extract these estimates and plot them:

```{r}
VCO2off.emm.df <-
  VCO2off.emm %>%
  broom::tidy()

VCO2off.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response") 
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(VCO2off.emm, "poly", max.degree = 2, adjustment = 'tukey')
```



### Marginal Mean Change comparisons

Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
VCO2off %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for VCO2 on transient.
```{r}
VCO2off %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
VCO2offpairs <- pairs(VCO2off.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(VCO2offpairs)
```

```{r}
VCO2off.rg <- ref_grid(VCO2off
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(VCO2off.rg)                    
VCO2off.rg
```

### Graphs with nesting
```{r}
plot(VCO2off.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(VCO2off.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(VCO2off, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(VCO2off, group = "bout",slope = TRUE, id = TRUE)
```
## RQon Nested data

For our post-hoc comparisons, we ensure that 'bout' is modeled as a factor which will enable mean comparisons between levels of 'bout'.

```{r}
# avgRQon$bout <- as.numeric(avgRQon$bout)
avgRQon$bout <- as.factor(avgRQon$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

RQon <- lmer(avgRQ~ Tanner*intensity + Gender + bout +(bout|ID)  , data = avgRQon, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
RQon.emm <- emmeans(RQon, ~ bout |intensity*Gender*Tanner)
RQon.emm
```
It might be nice to extract these estimates and plot them:

```{r}
RQon.emm.df <-
  RQon.emm %>%
  broom::tidy()

RQon.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response")
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(RQon.emm, "poly", max.degree = 2)
```



### Marginal Mean Change comparisons
Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
RQon %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for RQ on transient.
```{r}
RQon %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
RQonpairs <- pairs(RQon.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(RQonpairs)
```
```{r}
RQon.rg <- ref_grid(RQon
                    # , nesting = (Gender*Tanner) %in% intensity
                    )
str(RQon.rg)                    
RQon.rg
```

### Graphs with nesting
```{r}
plot(RQon.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(RQon.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(RQon, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(RQon, group = "bout",slope = TRUE, id = TRUE)
```
## RQoff Nested data

```{r}
# avgRQoff$bout <- as.numeric(avgRQoff$bout)
avgRQoff$bout <- as.factor(avgRQoff$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

RQoff <-  lmer(avgRQ~ bout*intensity + Gender*intensity + Tanner*intensity + (bout|ID)  ,  data = avgRQoff, REML=TRUE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
RQoff.emm <- emmeans(RQoff, ~ bout |intensity*Gender*Tanner)
RQoff.emm
```
It might be nice to extract these estimates and plot them:

```{r}
RQoff.emm.df <-
  RQoff.emm %>%
  broom::tidy()

RQoff.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response") 
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(RQoff.emm, "poly", max.degree = 2, adjustment = 'tukey')
```



### Marginal Mean Change comparisons

Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

```{r}
RQoff %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for RQ on transient.
```{r}
RQoff %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
RQoffpairs <- pairs(RQoff.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(RQoffpairs)
```



```{r}
RQoff.rg <- ref_grid(RQoff
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(RQoff.rg)                    
RQoff.rg
```

### Graphs with nesting
```{r}
plot(RQoff.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(RQoff.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(RQoff, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(RQoff, group = "bout",slope = TRUE, id = TRUE)
```
## VEon Nested data

For our post-hoc comparisons, we ensure that 'bout' is modeled as a factor which will enable mean comparisons between levels of 'bout'.

```{r}
# avgVEkglbmon$bout <- as.numeric(avgVEkglbmon$bout)
avgVEkglbmon$bout <- as.factor(avgVEkglbmon$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

VEon <- lmer(avgVEkglbm~bout + Gender + Tanner*intensity +(bout|ID)  , data = avgVEkglbmon, REML=TRUE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
VEon.emm <- emmeans(VEon, ~ bout |intensity*Gender*Tanner)
VEon.emm
```
It might be nice to extract these estimates and plot them:

```{r}
VEon.emm.df <-
  VEon.emm %>%
  broom::tidy()

VEon.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response")
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(VEon.emm, "poly", max.degree = 2)
```



### Marginal Mean Change comparisons
Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
VEon %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout.  
```{r}
VEon %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
VEonpairs <- pairs(VEon.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(VEonpairs)
```
```{r}
VEon.rg <- ref_grid(VEon
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(VEon.rg)                    
VEon.rg
```

### Graphs with nesting
```{r}
plot(VEon.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(VEon.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(VEon, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(VEon, group = "bout",slope = TRUE, id = TRUE)
```
## VEoff Nested data

```{r}
# avgVEkglbmoff$bout <- as.numeric(avgVEkglbmoff$bout)
avgVEkglbmoff$bout <- as.factor(avgVEkglbmoff$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

VEoff <- lmer(avgVEkglbm~Gender*intensity + bout*intensity + Tanner*intensity +(bout|ID) , data = avgVEkglbmoff, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
VEoff.emm <- emmeans(VEoff, ~ bout |intensity*Gender*Tanner)
VEoff.emm
```
It might be nice to extract these estimates and plot them:

```{r}
VEoff.emm.df <-
  VEoff.emm %>%
  broom::tidy()

VEoff.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response") 
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(VEoff.emm, "poly", max.degree = 2, adjustment = 'tukey')
```



### Marginal Mean Change comparisons

Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
VEoff %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout.  
```{r}
VEoff %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
VEoffpairs <- pairs(VEoff.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(VEoffpairs)
```



```{r}
VEoff.rg <- ref_grid(VEoff
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(VEoff.rg)                    
VEoff.rg
```

### Graphs with nesting
```{r}
plot(VEoff.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(VEoff.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(VEoff, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(VEoff, group = "bout",slope = TRUE, id = TRUE)
```
## RRon Nested data

For our post-hoc comparisons, we ensure that 'bout' is modeled as a factor which will enable mean comparisons between levels of 'bout'.

```{r}
# avgRRon$bout <- as.numeric(avgRRon$bout)
avgRRon$bout <- as.factor(avgRRon$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

RRon <- lmer(avgRR~ bout*intensity + Tanner + Gender  + (bout|ID)  , data = avgRRon, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
RRon.emm <- emmeans(RRon, ~ bout |intensity*Gender*Tanner)
RRon.emm
```
It might be nice to extract these estimates and plot them:

```{r}
RRon.emm.df <-
  RRon.emm %>%
  broom::tidy()

RRon.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response")
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(RRon.emm, "poly", max.degree = 2)
```



### Marginal Mean Change comparisons
Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
RRon %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for RR on transient.
```{r}
RRon %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
RRonpairs <- pairs(RRon.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(RRonpairs)
```



```{r}
RRon.rg <- ref_grid(RRon
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(RRon.rg)                    
RRon.rg
```

### Graphs with nesting
```{r}
plot(RRon.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(RRon.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(RRon, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(RRon, group = "bout",slope = TRUE, id = TRUE)
```
## RRoff Nested data

```{r}
# avgRRoff$bout <- as.numeric(avgRRoff$bout)
avgRRoff$bout <- as.factor(avgRRoff$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

RRoff <- lmer(avgRR~ bout*intensity + Gender*Tanner*bout + (bout|ID) , data = avgRRoff, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
RRoff.emm <- emmeans(RRoff, ~ bout |intensity*Gender*Tanner)
RRoff.emm
```
It might be nice to extract these estimates and plot them:

```{r}
RRoff.emm.df <-
  RRoff.emm %>%
  broom::tidy()

RRoff.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response") 
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(RRoff.emm, "poly", max.degree = 2, adjustment = 'tukey')
```



### Marginal Mean Change comparisons

Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
RRoff %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for RR on transient.
```{r}
RRoff %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
RRoffpairs <- pairs(RRoff.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(RRoffpairs)
```



```{r}
RRoff.rg <- ref_grid(RRoff
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(RRoff.rg)                    
RRoff.rg
```

### Graphs with nesting
```{r}
plot(RRoff.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(RRoff.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(RRoff, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(RRoff, group = "bout",slope = TRUE, id = TRUE)
```
## VE.VCO2on Nested data

For our post-hoc comparisons, we ensure that 'bout' is modeled as a factor which will enable mean comparisons between levels of 'bout'.

```{r}
# avgVE.VCO2on$bout <- as.numeric(avgVE.VCO2on$bout)
avgVE.VCO2on$bout <- as.factor(avgVE.VCO2on$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

VE.VCO2on <- lmer(avgVE.VCO2~ bout*intensity + Tanner*intensity + Gender  + (bout|ID)  , data = avgVE.VCO2on, REML=FALSE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
VE.VCO2on.emm <- emmeans(VE.VCO2on, ~ bout |intensity*Gender*Tanner)
VE.VCO2on.emm
```
It might be nice to extract these estimates and plot them:

```{r}
VE.VCO2on.emm.df <-
  VE.VCO2on.emm %>%
  broom::tidy()

VE.VCO2on.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response")
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(VE.VCO2on.emm, "poly", max.degree = 2)
```



### Marginal Mean Change comparisons
Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
VE.VCO2on %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for VE.VCO2 on transient.
```{r}
VE.VCO2on %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
VE.VCO2onpairs <- pairs(VE.VCO2on.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(VE.VCO2onpairs)
```



```{r}
VE.VCO2on.rg <- ref_grid(VE.VCO2on
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(VE.VCO2on.rg)                    
VE.VCO2on.rg
```

### Graphs with nesting
```{r}
plot(VE.VCO2on.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(VE.VCO2on.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(VE.VCO2on, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(VE.VCO2on, group = "bout",slope = TRUE, id = TRUE)
```
## VE.VCO2off Nested data

```{r}
# avgVE.VCO2off$bout <- as.numeric(avgVE.VCO2off$bout)
avgVE.VCO2off$bout <- as.factor(avgVE.VCO2off$bout) # for post-hoc analysis, we code the 'bout' parameter as a factor with 6 levels (for on-transient bouts) and 5 levels (for off-transient bouts).

VE.VCO2off <- lmer(avgVE.VCO2~ bout + Gender + Tanner* intensity + (bout|ID) , data = avgVE.VCO2off, REML=TRUE)
```

Below, we generate estimated marginal means for bout, as nested in intensity, Gender, and Tanner levels.
```{r}
VE.VCO2off.emm <- emmeans(VE.VCO2off, ~ bout |intensity*Gender*Tanner)
VE.VCO2off.emm
```
It might be nice to extract these estimates and plot them:

```{r}
VE.VCO2off.emm.df <-
  VE.VCO2off.emm %>%
  broom::tidy()

VE.VCO2off.emm.df %>%
  ggplot(aes(bout, estimate, ymin=estimate-std.error, ymax=estimate+std.error, color = Gender, shape = Tanner)) +
  geom_pointrange() +
  ylab("Response") 
```


### Checking for polynomial contrasts

'Bout' is treated as a factor in the model, but it corresponds to equally-spaced values of a numeric variable. In such cases, users often want to compute orthogonal polynomial contrasts:
to see if there was a linear or quadratic change in response over bouts.

This could provide an answer to our hypothesis, whether the response variable is increasing or decreasing significantly over bouts.

It is important to understand that the estimated linear contrast is not the slope of a line fitted to the data. It is simply a contrast having coefficients that increase linearly. It does test the linear trend, however.

It appears that there is a positive linear trend over bouts (a quadratic trend is also indicated and reported here):
```{r}
contrast(VE.VCO2off.emm, "poly", max.degree = 2, adjustment = 'tukey')
```



### Marginal Mean Change comparisons

Letâ€™s see how significant those differences are by analyzing mean changes and consecutive comparisons:

https://timmastny.rbind.io/blog/tests-pairwise-categorical-mean-emmeans-contrast/#consecutive-comparisons

This will show us before and after mean comparisons. Itâ€™s similar to consecutive comparisons, because it often only makes sense for sequential factors like time.

This oneâ€™s also unique, because the unit of comparison is not necessarily an individual member of a category, but rather groups compared to other groups.

This type of analysis is useful for non-linear trends, where you want to identity the change point (hence the name before and after).

 
```{r}
VE.VCO2off %>% 
  emmeans(mean_chg ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")
```

### Consecutive marginal means comparisons
Letâ€™s see how significant those differences are by doing consecutive comparisons.

Consecutive marginal means comparisons show varying levels of significance when comparing one Bout to the following Bout. However, all of the statistically significant estimates are POSITIVE, indicating a positive trend for VE.VCO2 on transient.
```{r}
VE.VCO2off %>% 
  emmeans(consec ~ bout|intensity * Gender * Tanner
          # , at = list(Gender="MALE",Tanner="Late")
          ) %>% 
  pluck("contrasts")

```

### Pairwise Mean Comparisons
```{r}
VE.VCO2offpairs <- pairs(VE.VCO2off.emm, simple = "each", combine = TRUE, reverse = TRUE, adjustment = 'tukey')

print(VE.VCO2offpairs)
```

```{r}
VE.VCO2off.rg <- ref_grid(VE.VCO2off
                    # , nesting = (Gender*Tanner) %in% intensity
                    )

str(VE.VCO2off.rg)                    
VE.VCO2off.rg
```

### Graphs with nesting
```{r}
plot(VE.VCO2off.emm, PIs = TRUE) + 
    facet_wrap(~ Gender*Tanner*intensity, nrow = 2, scales = "free_y")
```
```{r}
# Pairwise comparisons are an example of linear functions of EMMs. You may use coef() to see the coefficients of these linear functions:

coef(pairs(VE.VCO2off.emm))
```

### Interactions with covariates
When a covariate and a factor interact, we typically donâ€™t want EMMs themselves, but rather estimates of slopes of the covariate trend for each level of the factor.  

To visualize the lines themselves:

```{r}
emmip(VE.VCO2off, ~ bout | Tanner*Gender*intensity, cov.reduce = range)
```

### Predictmeans package
Residuals vs Fitted plots
```{r}
library(predictmeans)
residplot(VE.VCO2off, group = "bout",slope = TRUE, id = TRUE)
```
