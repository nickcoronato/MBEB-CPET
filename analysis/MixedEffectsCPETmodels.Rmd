---
title: "MixedEffectsCPETmodels"
author: "nickcoronato"
date: "2021-07-16"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---
```{r load libraries, echo = FALSE}
# Call the appropriate libraries.
library(tidyverse)
library(plyr)
library(dplyr)
library(splines)
library(boot)
library(broom)
library(lme4)
library(lmerTest)
library(jtools)
library(devtools)
library(lattice)
library(fifer)
library(flexplot)
library(sjPlot)
library(officer)
library(flextable)
library(lsmeans)
library(effects)
library(ggiraph)
library(ggiraphExtra)
library(ggeffects)
library(emmeans)
library(performance)
```
```{r options1}
options(max.print=99999)
control=lmerControl(check.conv.singular = .makeCC(action = "ignore",  tol = 1e-4))
```

# Data preparation

## Read in the csv of clean data, from this project's "Data" folder.
```{r Read in data, message = FALSE, include = FALSE}
here::i_am("analysis/MixedEffectsCPETmodels.Rmd")
library(here)

all_GK_raw  <-  read_delim(here("data","all_data.csv"),"," ) #This is the raw data set

# This next step divides the full time series for each subject into their 5-10 Exercise and Recovery bouts. Bouts labelled with a ".5" suffix are the recovery (off-transient) bouts.

all_GK_bybout <- mutate(all_GK_raw, 
                        bout =case_when(
  (Time_Sec<120 & Work < 10)~"0",
  (Time_Sec >= 2 & Time_Sec < 175 & Work >=10)~"1",
  (Time_Sec<185 & Work < 10)~"1.5",
  (Time_Sec >= 175 & Time_Sec<300 & Work >=10)~"2",
  (Time_Sec<365 & Work < 10)~"2.5",
  (Time_Sec >= 300 & Time_Sec < 495 & Work >=10)~"3",
  (Time_Sec<545 & Work < 10)~"3.5",
  (Time_Sec >= 495 & Time_Sec <675 & Work >=10)~"4",
  (Time_Sec<725 & Work < 10)~"4.5",
  (Time_Sec >= 675 & Time_Sec <855 & Work >=10)~"5",
  (Time_Sec<905 & Work < 10)~"5.5", 
  (Time_Sec >= 855 & Time_Sec <1035 & Work >= 10)~"6", 
  (Time_Sec<1085 & Work < 10)~"6.5", 
  (Time_Sec >= 1035 & Time_Sec <1215 & Work >= 10)~"7", 
  (Time_Sec<1265 & Work < 10)~"7.5",
  (Time_Sec >= 1215 & Time_Sec <1400 & Work >= 10)~"8", 
  (Time_Sec <1445 & Work < 10)~"8.5",
  (
    # Time_Sec >= 1400 & 
      Time_Sec <1575 & Work >= 10)~"9",
  (
    # Time_Sec >= 1540 & 
     Time_Sec<1625 & Work < 10)~"9.5",
  (Time_Sec >= 1575 & Work >= 10)~"10", 
  (Time_Sec >= 1625 & Work < 10)~"10.5"))

names(all_GK_bybout)[13] <- "Tanner"
# 'Tanner' column is the descriptor for the puberty variable. Early pubertal subjects score 1-2 on the Tanner scale, and late pubertal subjects score 4-5.

# The next step ensures that we have all variables of interest. Note that some are normalized by bodymass (kg) and lean body mass (kg), which are slightly different measurements.
all_GK_bybout <- mutate(all_GK_bybout, "VO2/kglbm"=VO2 / lbm,"VE/VCO2" = (VE / VCO2),"VCO2/kg" =  VCO2/bodymass,"VE/kg" = VE/bodymass, "VCO2/kglbm" =  VCO2/lbm,"VE/kglbm" = VE/lbm)


# All variables should be coded as Factors, with the exception of bout, which is our discrete repeated measure.
all_GK_bybout$Tanner <- as.factor(all_GK_bybout$Tanner)
all_GK_bybout$Gender <- as.factor(all_GK_bybout$Gender)
all_GK_bybout$intensity <- as.factor(all_GK_bybout$intensity)
# all_GK_bybout$bout <- as.factor(all_GK_bybout$bout)
all_GK_bybout$ID <- as.factor(all_GK_bybout$ID)


all_GK_bybout <- all_GK_bybout %>% dplyr::select(ID, bodymass, lbm, intensity, Tanner, Gender, bout, Time_Sec, Work, HR, VO2, 'VO2/kg', 'VO2/kglbm', VCO2, 'VCO2/kg', 'VCO2/kglbm', RQ, VE, 'VE/kg','VE/kglbm', RR, `VE/VCO2`)
all_GK_bybout <- as_tibble(all_GK_bybout)

head(all_GK_bybout,6)

# Check for any NA values in bout column.
(extra_NA <- all_GK_bybout[is.na(all_GK_bybout$bout),])

(summary(all_GK_bybout)) 
```

Create a 'demographics' table for later use, which contains the listing of IDs used in the models.
```{r create demographics}
demographics <- distinct(all_GK_bybout, ID, .keep_all=TRUE)[,1:6]
```

## Convert the 'bout' variable to discrete numeric values. For the off-transient bouts (recovery periods), subtract 1.5 in order to center the variable at 0 for further analysis.
```{r Convert bout var, message=FALSE, warning=FALSE}
ontransbouts <- filter(all_GK_bybout,bout%in%c(0,1,2,3,4,5))
ontransbouts$bout <- as.numeric(ontransbouts$bout)

offtransbouts <- filter(all_GK_bybout,bout%in%c(1.5,2.5,3.5,4.5,5.5,6.5))
offtransbouts$bout <- as.numeric(offtransbouts$bout)
offtransbouts <- mutate(offtransbouts, bout = bout-1.5)
```

## Compute the averages. Pull out the 'avgHR' at each "on-transient" and "off-transient" bout (1-5).
```{r compute avgHR}
avgHRon <- aggregate(ontransbouts$HR, by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgHRon)[6] <- "avgHR"

avgHRoff <- aggregate(offtransbouts$HR, by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgHRoff)[6] <- "avgHR"
```

## Data visualization. Plot the average HR data distributions.
```{r plot avgHR}
# plot the avg ON-transient HR
ggplot(data=avgHRon, aes(bout, avgHR, color = intensity)) + geom_point() + ggtitle("On-Transient average heart rates")

# plot the avg off-transient HR
ggplot(data=avgHRoff, aes(bout, avgHR, color = intensity)) + geom_point()+ ggtitle("Off-Transient average heart rates")

ggplot(data=filter(avgHRon, intensity == "low"), aes(x = bout,y= avgHR, group = ID)) + geom_line() + ggtitle("Low intensity, Avg HR for on-transient periods")+ ylim(80,210) 

ggplot(data=filter(avgHRoff, intensity == "low"), aes(x = bout,y= avgHR, group = ID)) + geom_line() + ggtitle("Low intensity, Avg HR for off-transient periods")+ ylim(80,210)

ggplot(data=filter(avgHRon, intensity == "high"), aes(x = bout,y= avgHR, group = ID)) + geom_line() + ggtitle("High intensity, Avg HR for on-transient periods") + ylim(80,210) 

ggplot(data=filter(avgHRoff, intensity == "high"), aes(x = bout,y= avgHR, group = ID)) + geom_line() + ggtitle("High intensity, Avg HR for off-transient periods") + ylim(80,210)
```

### Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot avgHR}
xyplot(avgHR ~ bout | Gender*Tanner, data = avgHRon, groups = intensity, 
       type = c("p","r"), 
       auto.key = TRUE)

xyplot(avgHR ~ bout | ID, data = avgHRon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgHR ~ bout | ID, data = avgHRon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r boxplot avgHR}
boxplot(avgHR~Gender*Tanner*bout*intensity, data = avgHRon)
```

```{r flexplot avgHR}
### Viewing the categorical variables of interest

# Flexplot of Gender distribution
flexplot(avgHR~Gender, data=avgHRon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgHR~Gender, data=avgHRoff, spread="quartiles", jitter=c(.1, 0))

# Flexplot of Puberty distribution
flexplot(avgHR~Tanner, data=avgHRon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgHR~Tanner, data=avgHRoff, spread="quartiles", jitter=c(.1, 0))


### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgHR~bout + intensity | Gender + Tanner, data=avgHRon, method="lm", se=F, bins=2)

### multivariate relationship (this is more data exploration, prior to the real modeling.)
flexplot(avgHR~bout + intensity | Gender + Tanner, data=avgHRon)
flexplot(avgHR~bout + Gender | intensity + Tanner, data=avgHRon)
flexplot(avgHR~bout + Tanner | intensity + Gender, data=avgHRon)
```


#################################################

# LINEAR MIXED EFFECTS MODELING with the lme4 package
This next section is the full procedure for step-wise variable selection to identify the appropriate mixed-effects model.

In total, there are 14 selected models. Each physiological signal (x7) has two associated models: one linear model is fit to the On-Transient average responses, and a second model is fit to the Off-Transient averages. 

The final multi-level models (MLMs) were chosen through a stepwise variable selection approach that began with the most complex model. Fixed effects considered in the full model were: 
Gender, a factor with two levels (Male, Female); 
Maturational status, a factor with two levels (Early, Late); 
work intensity, a factor with two levels (Low, High); 
and Bout, a continuous predictor in the range of 0 to 5. 

Random slope and intercept were allowed in the bout term for each participant ID in order to account for individual variation between subjects. This controlled for innate differences between subjectsâ€™ physical fitness levels, psychological motivation, and other non-measured variables. If the full model showed insignificance (p-value > 0.05) in the four-way interaction (Gender* Puberty * Intensity * Bout), the model was re-fit with only three-way interactions. 

This stepwise process was repeated, removing higher-level interactions until all fixed effects were statistically significant or no more interactions existed. In order to determine that a simpler model provided better fit than the previous (more complex) model, a standard ANOVA process and Chi-squared comparison was used, as well as a check for reduction in BIC and a Bayes Factor analysis. The simplest possible models used only fixed effects for Gender, Puberty, Intensity, and Bout. However, each of the final 14 models included a unique combination of fixed effects and cross-level interactions that required careful interpretation. Residual plots were analyzed for each final model to confirm an appropriate fit.

The first physiological signal for analysis is Heart Rate (HR).

## HR ON Transient

### Null Model
The null model does not use any predictor variables from the other levels (Gender, Tanner, intensity, bout). This is also considered the "intercept only" model.
```{r}
nullmod <- lmer(avgHR ~ 1 + (1|ID), data = avgHRon, REML = TRUE)
(summ(nullmod) ->summnullHRon)
(BIC(nullmod) -> BICnullHRon)
(summnullHRon$gvars[,3] -> ICCnullHRon)
```

### Model 1: All interactions
The intermediate model uses all predictor variables and their interactions (Gender, Tanner, intensity, bout) with a random slope.
```{r m1 HRon}
intHRon <- lmer(avgHR~Gender*Tanner*intensity*bout +(bout|ID), data = avgHRon, REML=FALSE)
# summary(intHRon)
(summ(intHRon)->summintHRon)
(BIC(intHRon) -> BICintHRon)
(summintHRon$gvars[,3] -> ICCintHRon)
# coef(intHRon)
# fixef(intHRon)
# ranef(intHRon)
```

### Model 1B: Some interactions
The final model uses a subset of the predictor variables; the three-way interaction of Tanner:Bout:Intensity is the highest-level interaction with reported significance level p<=0.05. Model 1B becomes the final model for on-transient HR, 'HRon'.
```{r m1B HRon}
HRon <- lmer(avgHR~Gender + Tanner * bout * intensity + (bout|ID)  , data = avgHRon, REML=FALSE)
# summary(HRon)
# coef(HRon)
# ranef(HRon)
(summ(HRon)->summHRon)
(BIC(HRon) -> BICHRon)
(summHRon$gvars[,3] -> ICCHRon)
```

### Comparing On transient models
```{r compare HRon}
improve.fit(HRon,intHRon)
anova(HRon, intHRon)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r HRoncoefs}
HRoncoefs <- as_tibble(coef(HRon)$ID)

HRoncoefs <- tibble(demographics, HRoncoefs$bout)

write.csv(HRoncoefs,"~/R/MBEB-CPET/output/HRoncoefs.csv", row.names = TRUE)
```


## HR OFF transient
### Null Model
The null model does not use any predictor variables from the other levels (Gender, Tanner, intensity, bout). This is also considered the "intercept only" model.
```{r}
nullmod <- lmer(avgHR ~ 1 + (1|ID), data = avgHRoff, REML = TRUE)
(summ(nullmod) ->summnullHRoff)
(BIC(nullmod) -> BICnullHRoff)
(summnullHRoff$gvars[,3] -> ICCnullHRoff)
```

### Model 2: OFF TRANSIENT: All interactions

```{r m2 HRoff}
intHRoff <- lmer(avgHR~Gender*Tanner*bout*intensity + (bout|ID)  , data = avgHRoff, REML=FALSE)
# summary(intHRoff)
(summ(intHRoff)->summintHRoff)
(BIC(intHRoff) -> BICintHRoff)
(summintHRoff$gvars[,3] -> ICCintHRoff)
# coef(intHRoff)
# ranef(intHRoff)
```

### Model 2C: Some interactions
```{r m2c HRoff}
HRoff <- lmer(avgHR~ bout * intensity + Tanner*intensity + Gender*intensity + (bout|ID)  ,  data = avgHRoff, REML=FALSE)
# summary(intHRoff)
(summ(HRoff)->summHRoff)
(BIC(HRoff) -> BICHRoff)
(summHRoff$gvars[,3] -> ICCHRoff)
# coef(intHRoff)
# fixef(intHRoff)
# ranef(intHRoff)
```

### Comparing Off transient models
```{r compare HRoff}
improve.fit(HRoff,intHRoff)
anova(HRoff, intHRoff)
```
```{r bayes factor HRoff}
# Bayes factor = probability of full model / probability of reduced model - it's an odds. We can approximate BF using BIC:
# in general, BF >10 = strong evidence in favor of the model in the numerator
bf.bic(HRoff,intHRoff)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r HRoff coefs}
HRoffcoefs <- as_tibble(coef(HRoff)$ID)

HRoffcoefs <- tibble(demographics, HRoffcoefs$bout)

write.csv(HRoffcoefs,"~/R/MBEB-CPET/output/HRoffcoefs.csv", row.names = TRUE)
```

## VO2/kg LEAN BODY MASS On Transient

First, pull out the average on and off transient VO2kg values for each bout.
```{r compute vo2kglbm avg}
avgVO2kglbmon <- aggregate(ontransbouts$'VO2/kg', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVO2kglbmon)[6] <- "avgVO2kglbm"

avgVO2kglbmoff <- aggregate(offtransbouts$'VO2/kg', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVO2kglbmoff)[6] <- "avgVO2kglbm"
```


### Plot the average VO2kglbm data distributions.
```{r plot vo2kglbm}
#plot the avg ON-transient VO2kglbm
ggplot(data=avgVO2kglbmon, aes(bout, avgVO2kglbm, color = intensity)) + geom_point() + ggtitle("On-Transient average VO2/kg rates")

#plot the avg off-transient VO2kglbm
ggplot(data=avgVO2kglbmoff, aes(bout, avgVO2kglbm, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VO2/kg rates")

ggplot(data=filter(avgVO2kglbmon, intensity == "low"), aes(x = bout,y= avgVO2kglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VO2kglbm for on-transient periods") + ylim(0,75) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVO2kglbmoff, intensity == "low"), aes(x = bout,y= avgVO2kglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VO2kglbm for off-transient periods")+  ylim(0,75) 

ggplot(data=filter(avgVO2kglbmon, intensity == "high"), aes(x = bout,y= avgVO2kglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VO2kglbm for on-transient periods")  + ylim(0,75) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVO2kglbmoff, intensity == "high"), aes(x = bout,y= avgVO2kglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VO2kglbm for off-transient periods") + ylim(0,75)  
```

### Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot vo2kglbm}
xyplot(avgVO2kglbm ~ bout | ID, data = avgVO2kglbmon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVO2kglbm ~ bout | ID, data = avgVO2kglbmon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVO2kglbm ~ bout | ID, data = avgVO2kglbmon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r flexplot vo2kglbm}
### categorical variable
flexplot(avgVO2kglbm~Gender, data=avgVO2kglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVO2kglbm~Gender, data=avgVO2kglbmoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVO2kglbm~Tanner, data=avgVO2kglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVO2kglbm~Tanner, data=avgVO2kglbmoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVO2kglbm~bout + intensity | Gender + Tanner, data=avgVO2kglbmon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVO2kglbm~bout + intensity | Gender + Tanner, data=avgVO2kglbmon)
flexplot(avgVO2kglbm~bout + Gender | intensity + Tanner, data=avgVO2kglbmon)
flexplot(avgVO2kglbm~bout + Tanner | intensity + Gender, data=avgVO2kglbmon)
```



### Null Model
```{r}
nullmod <- lmer(avgVO2kglbm ~ 1 + (1|ID), data = avgVO2kglbmon, REML = TRUE)
(summ(nullmod) ->summnullVO2KGLBMon)
(BIC(nullmod) -> BICnullVO2KGLBMon)
(summnullVO2KGLBMon$gvars[,3] -> ICCnullVO2KGLBMon)
```
### Model 1: All interactions

```{r m1 vo2kglbmon}
intVO2KGLBMon <- lmer(avgVO2kglbm~Gender*Tanner*bout*intensity +(bout|ID) , data = avgVO2kglbmon, REML=FALSE)
# summary(intVO2KGLBMon)
(summ(intVO2KGLBMon)->summintVO2KGLBMon)
(BIC(intVO2KGLBMon) -> BICintVO2KGLBMon)
(summintVO2KGLBMon$gvars[,3] -> ICCintVO2KGLBMon)
# coef(intVO2KGLBMon)
# fixef(intVO2KGLBMon)
# ranef(intVO2KGLBMon)
```

### Model 1C: Some interactions

```{r m1c vo2kglbmon}
VO2KGLBMon <- lmer(avgVO2kglbm~ bout*intensity + Gender* intensity + Tanner + (bout|ID) , data = avgVO2kglbmon, REML=FALSE)
# summary(VO2KGLBMon)
# coef(VO2KGLBMon)
# ranef(VO2KGLBMon)
(summ(VO2KGLBMon)->summVO2KGLBMon)
(BIC(VO2KGLBMon) -> BICVO2KGLBMon)
(summVO2KGLBMon$gvars[,3] -> ICCVO2KGLBMon)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r vo2kglbmon coefs}
VO2oncoefs <- as_tibble(coef(VO2KGLBMon)$ID)

VO2oncoefs <- tibble(demographics, VO2oncoefs$bout)

write.csv(VO2oncoefs,"~/R/MBEB-CPET/output/VO2oncoefs.csv", row.names = TRUE)
```

## VO2kglbm OFF TRANSIENT

### Null Model
```{r}
nullmod <- lmer(avgVO2kglbm ~ 1 + (1|ID), data = avgVO2kglbmoff, REML = TRUE)
(summ(nullmod) ->summnullVO2KGLBMoff)
(BIC(nullmod) -> BICnullVO2KGLBMoff)
(summnullVO2KGLBMoff$gvars[,3] -> ICCnullVO2KGLBMoff)
```

### Model 2: All interactions

```{r m2 vo2kglbmoff}
intVO2KGLBMoff <- lmer(avgVO2kglbm~Gender*Tanner*bout*intensity +(bout|ID) ,data = avgVO2kglbmoff, REML=FALSE)
# summary(intVO2KGLBMoff)
(summ(intVO2KGLBMoff)->summintVO2KGLBMoff)
(BIC(intVO2KGLBMoff) -> BICintVO2KGLBMoff)
(summintVO2KGLBMoff$gvars[,3] -> ICCintVO2KGLBMoff)
# coef(intVO2KGLBMoff)
# fixef(intVO2KGLBMoff)
# ranef(intVO2KGLBMoff)
```

### Model 2C: Some interactions
```{r m2c vo2kglbmoff}
VO2KGLBMoff <- lmer(avgVO2kglbm~ bout*intensity + Gender*intensity + Tanner*intensity + (bout|ID) , data = avgVO2kglbmoff, REML=FALSE)
# summary(VO2KGLBMoff)
# coef(VO2KGLBMoff)
# ranef(VO2KGLBMoff)
(summ(VO2KGLBMoff)->summVO2KGLBMoff)
(BIC(VO2KGLBMoff) -> BICVO2KGLBMoff)
(summVO2KGLBMoff$gvars[,3] -> ICCVO2KGLBMoff)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r vo2kglbmoff coefs}
VO2offcoefs <- as_tibble(coef(VO2KGLBMoff)$ID)

VO2offcoefs <- tibble(demographics, VO2offcoefs$bout)

write.csv(VO2offcoefs,"~/R/MBEB-CPET/output/VO2offcoefs.csv", row.names = TRUE)
```

## VCO2/kg lean body mass On Transient

First, pull out the average on and off transient VCO2kglbm values for each bout.
```{r compute VCO2kglbm avg}
avgVCO2kglbmon <- aggregate(ontransbouts$'VCO2/kglbm', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVCO2kglbmon)[6] <- "avgVCO2kglbm"

avgVCO2kglbmoff <- aggregate(offtransbouts$'VCO2/kglbm', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVCO2kglbmoff)[6] <- "avgVCO2kglbm"
```

### Plot the average VCO2kglbm data distributions.
```{r plot VCO2kglbm}
#plot the avg ON-transient VCO2kglbm
ggplot(data=avgVCO2kglbmon, aes(bout, avgVCO2kglbm, color = intensity)) + geom_point() + ggtitle("On-Transient average VO2/kg rates")

#plot the avg off-transient VCO2kglbm
ggplot(data=avgVCO2kglbmoff, aes(bout, avgVCO2kglbm, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VCO2kglbm rates")

ggplot(data=filter(avgVCO2kglbmon, intensity == "low"), aes(x = bout,y= avgVCO2kglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VCO2kglbm for on-transient periods") + ylim(0,0.2) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVCO2kglbmoff, intensity == "low"), aes(x = bout,y= avgVCO2kglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VCO2kglbm for off-transient periods")+  ylim(0,0.2)

ggplot(data=filter(avgVCO2kglbmon, intensity == "high"), aes(x = bout,y= avgVCO2kglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VCO2kglbm for on-transient periods")  + ylim(0,0.2)
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVCO2kglbmoff, intensity == "high"), aes(x = bout,y= avgVCO2kglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VCO2kglbm for off-transient periods") + ylim(0,0.2)
```

### Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot VCO2kglbm}
xyplot(avgVCO2kglbm ~ bout | ID, data = avgVCO2kglbmon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVCO2kglbm ~ bout | ID, data = avgVCO2kglbmon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVCO2kglbm ~ bout | ID, data = avgVCO2kglbmon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r flexplot VCO2kglbm}
### categorical variable
flexplot(avgVCO2kglbm~Gender, data=avgVCO2kglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVCO2kglbm~Gender, data=avgVCO2kglbmoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVCO2kglbm~Tanner, data=avgVCO2kglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVCO2kglbm~Tanner, data=avgVCO2kglbmoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVCO2kglbm~bout + intensity | Gender + Tanner, data=avgVCO2kglbmon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVCO2kglbm~bout + intensity | Gender + Tanner, data=avgVCO2kglbmon)
flexplot(avgVCO2kglbm~bout + Gender | intensity + Tanner, data=avgVCO2kglbmon)
flexplot(avgVCO2kglbm~bout + Tanner | intensity + Gender, data=avgVCO2kglbmon)
```


### Null Model
```{r}
nullmod <- lmer(avgVCO2kglbm ~ 1 + (1|ID), data = avgVCO2kglbmon, REML = TRUE)
(summ(nullmod) ->summnullVCO2kglbmon)
(BIC(nullmod) -> BICnullVCO2kglbmon)
(summnullVCO2kglbmon$gvars[,3] -> ICCnullVCO2kglbmon)
```

### Model 1: All interactions

```{r m1 VCO2kglbmon}
intVCO2kglbmon <- lmer(avgVCO2kglbm~bout*intensity*Gender*Tanner +(bout|ID)  , data = avgVCO2kglbmon, REML=FALSE)
# summary(intVCO2kglbmon)
(summ(intVCO2kglbmon)->summintVCO2kglbmon)
(BIC(intVCO2kglbmon) -> BICintVCO2kglbmon)
(summintVCO2kglbmon$gvars[,3] -> ICCintVCO2kglbmon)
# coef(intVCO2kglbmon)
# fixef(intVCO2kglbmon)
# ranef(intVCO2kglbmon)
```

### Model 1B: Some interactions

```{r m1b VCO2kglbmon}
VCO2kglbmon <- lmer(avgVCO2kglbm~ Gender + Tanner*bout + Tanner*intensity + Gender*intensity + (bout|ID), data = avgVCO2kglbmon, REML=FALSE)
# summary(VCO2kglbmon)
# coef(VCO2kglbmon)
# ranef(VCO2kglbmon)
(summ(VCO2kglbmon)->summVCO2kglbmon)
(BIC(VCO2kglbmon) -> BICVCO2kglbmon)
(summVCO2kglbmon$gvars[,3] -> ICCVCO2kglbmon)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r VCO2kglbmon coefs}
VCO2oncoefs <- as_tibble(coef(VCO2kglbmon)$ID)

VCO2oncoefs <- tibble(demographics, VCO2oncoefs$bout)

write.csv(VCO2oncoefs,"~/R/MBEB-CPET/output/VCO2oncoefs.csv", row.names = TRUE)
```

## VCO2/kg lean body mass OFF TRANSIENT

### Null Model
```{r}
nullmod <- lmer(avgVCO2kglbm ~ 1 + (1|ID), data = avgVCO2kglbmoff, REML = TRUE)
(summ(nullmod) ->summnullVCO2kglbmoff)
(BIC(nullmod) -> BICnullVCO2kglbmoff)
(summnullVCO2kglbmoff$gvars[,3] -> ICCnullVCO2kglbmoff)
```

### Model 2: All interactions

```{r m2 VCO2kglbmoff}
intVCO2kglbmoff <- lmer(avgVCO2kglbm~Gender*Tanner*bout*intensity + (bout|ID) , data = avgVCO2kglbmoff, REML=FALSE)
# summary(intVCO2kglbmoff)
(summ(intVCO2kglbmon)->summintVCO2kglbmon)
(BIC(intVCO2kglbmon) -> BICintVCO2kglbmon)
(summintVCO2kglbmon$gvars[,3] -> ICCintVCO2kglbmon)
# coef(intVCO2kglbmoff)
# fixef(intVCO2kglbmoff)
# ranef(intVCO2kglbmoff)
```

### Model 2C: Some interactions
```{r m2c VCO2kglbmoff}
VCO2kglbmoff <- lmer(avgVCO2kglbm ~ bout + Gender*intensity +Tanner*intensity + (bout|ID),  data = avgVCO2kglbmoff, REML=FALSE)
# summary(VCO2kglbmoff)
# coef(VCO2kglbmoff)
# ranef(VCO2kglbmoff)
(summ(VCO2kglbmoff)->summVCO2kglbmoff)
(BIC(VCO2kglbmoff) -> BICVCO2kglbmoff)
(summVCO2kglbmoff$gvars[,3] -> ICCVCO2kglbmoff)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r VCO2kglbmoff coefs}
VCO2offcoefs <- as_tibble(coef(VCO2kglbmoff)$ID)

VCO2offcoefs <- tibble(demographics, VCO2offcoefs$bout)

write.csv(VCO2offcoefs,"~/R/MBEB-CPET/output/VCO2offcoefs.csv", row.names = TRUE)
```

## RQ On Transient

First, pull out the average on and off transient RQ values for each bout.
```{r compute RQ avg}
avgRQon <- aggregate(ontransbouts$RQ, by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgRQon)[6] <- "avgRQ"

avgRQoff <- aggregate(offtransbouts$RQ, by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgRQoff)[6] <- "avgRQ"
```

### Plot the average RQ data distributions.
```{r plot RQ}
#plot the avg ON-transient RQ
ggplot(data=avgRQon, aes(bout, avgRQ, color = intensity)) + geom_point() + ggtitle("On-Transient average RQ rates")

#plot the avg off-transient RQ
ggplot(data=avgRQoff, aes(bout, avgRQ, color = intensity)) + geom_point()+ ggtitle("Off-Transient average RQ rates")

ggplot(data=filter(avgRQon, intensity == "low"), aes(x = bout,y= avgRQ, group = ID)) + geom_line() + ggtitle("Low intensity, Avg RQ for on-transient periods") + ylim(0,2) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgRQoff, intensity == "low"), aes(x = bout,y= avgRQ, group = ID)) + geom_line() + ggtitle("Low intensity, Avg RQ for off-transient periods")+  ylim(0,2) 

ggplot(data=filter(avgRQon, intensity == "high"), aes(x = bout,y= avgRQ, group = ID)) + geom_line() + ggtitle("High intensity, Avg RQ for on-transient periods")  + ylim(0,2) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgRQoff, intensity == "high"), aes(x = bout,y= avgRQ, group = ID)) + geom_line() + ggtitle("High intensity, Avg RQ for off-transient periods") + ylim(0,2)  
```

### Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r xyplot RQ}
xyplot(avgRQ ~ bout | ID, data = avgRQon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgRQ ~ bout | ID, data = avgRQon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgRQ ~ bout | ID, data = avgRQon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r flexplot RQ}
### categorical variable
flexplot(avgRQ~Gender, data=avgRQon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgRQ~Gender, data=avgRQoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgRQ~Tanner, data=avgRQon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgRQ~Tanner, data=avgRQoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgRQ~bout + intensity | Gender + Tanner, data=avgRQon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgRQ~bout + intensity | Gender + Tanner, data=avgRQon)
flexplot(avgRQ~bout + Gender | intensity + Tanner, data=avgRQon)
flexplot(avgRQ~bout + Tanner | intensity + Gender, data=avgRQon)
```


### Null Model
```{r}
nullmod <- lmer(avgRQ ~ 1 + (1|ID), data = avgRQon, REML = TRUE)
(summ(nullmod) ->summnullRQon)
(BIC(nullmod) -> BICnullRQon)
(summnullRQon$gvars[,3] -> ICCnullRQon)
```
### Model 1: All interactions

```{r m1 RQon}
intRQon <- lmer(avgRQ~ bout*Gender*Tanner*intensity + (bout|ID)  , data = avgRQon, REML=FALSE)
# summary(intRQon)
(summ(intRQon)->summintRQon)
(BIC(intRQon) -> BICintRQon)
(summintRQon$gvars[,3] -> ICCintRQon)
# coef(intRQon)
# fixef(intRQon)
# ranef(intRQon)
```

### Model 1C: Some interactions

```{r m1C RQon}
RQon <- lmer(avgRQ~ Tanner*intensity + Gender + bout +(bout|ID)  , data = avgRQon, REML=FALSE)
# summary(RQon)
# coef(RQon)
# ranef(RQon)
(summ(RQon)->summRQon)
(BIC(RQon) -> BICRQon)
(summRQon$gvars[,3] -> ICCRQon)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r RQon coefs}
RQoncoefs <- as_tibble(coef(RQon)$ID)

RQoncoefs <- tibble(demographics, RQoncoefs$bout)

write.csv(RQoncoefs,"~/R/MBEB-CPET/output/RQoncoefs.csv", row.names = TRUE)
```

## RQ OFF TRANSIENT

### Null Model
```{r}
nullmod <- lmer(avgRQ ~ 1 + (1|ID), data = avgRQoff, REML = TRUE)
(summ(nullmod) ->summnullRQoff)
(BIC(nullmod) -> BICnullRQoff)
(summnullRQoff$gvars[,3] -> ICCnullRQoff)
```

### Model 2: All interactions

```{r m2 RQoff}
intRQoff <- lmer(avgRQ~ bout*Gender*Tanner*intensity +(bout|ID)  , data = avgRQoff, REML=FALSE)
# summary(intRQoff)
(summ(intRQoff)->summintRQoff)
(BIC(intRQoff) -> BICintRQoff)
(summintRQoff$gvars[,3] -> ICCintRQoff)
# coef(intRQoff)
# fixef(intRQoff)
# ranef(intRQoff)
```

### Model 2C: No interactions
```{r m2c RQoff}
RQoff <- lmer(avgRQ~ bout*intensity + Gender*intensity + Tanner*intensity + (bout|ID)  ,  data = avgRQoff, REML=FALSE)
# summary(RQoff)
# coef(RQoff)
# ranef(RQoff)
(summ(RQoff)->summRQoff)
(BIC(RQoff) -> BICRQoff)
(summRQoff$gvars[,3] -> ICCRQoff)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r RQoff coefs}
RQoffcoefs <- as_tibble(coef(RQoff)$ID)

RQoffcoefs <- tibble(demographics, RQoffcoefs$bout)

write.csv(RQoffcoefs,"~/R/MBEB-CPET/output/RQoffcoefs.csv", row.names = TRUE)
```

## VE/kglbm On Transient

First, pull out the average on and off transient VEkglbm values for each bout.
```{r}
avgVEkglbmon <- aggregate(ontransbouts$'VE/kglbm', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVEkglbmon)[6] <- "avgVEkglbm"

avgVEkglbmoff <- aggregate(offtransbouts$'VE/kglbm', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVEkglbmoff)[6] <- "avgVEkglbm"
```

### Plot the average VEkglbm data distributions.
```{r}
#plot the avg ON-transient VEkglbm
ggplot(data=avgVEkglbmon, aes(bout, avgVEkglbm, color = intensity)) + geom_point() + ggtitle("On-Transient average VEkglbm rates")

#plot the avg off-transient VEkglbm
ggplot(data=avgVEkglbmoff, aes(bout, avgVEkglbm, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VEkglbm rates")

ggplot(data=filter(avgVEkglbmon, intensity == "low"), aes(x = bout,y= avgVEkglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VEkglbm for on-transient periods") + ylim(0,5) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVEkglbmoff, intensity == "low"), aes(x = bout,y= avgVEkglbm, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VEkglbm for off-transient periods")+  ylim(0,5)  

ggplot(data=filter(avgVEkglbmon, intensity == "high"), aes(x = bout,y= avgVEkglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VEkglbm for on-transient periods")  + ylim(0,5)  
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVEkglbmoff, intensity == "high"), aes(x = bout,y= avgVEkglbm, group = ID)) + geom_line() + ggtitle("High intensity, Avg VEkglbm for off-transient periods") + ylim(0,5) 
```

### Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r}
xyplot(avgVEkglbm ~ bout | ID, data = avgVEkglbmon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVEkglbm ~ bout | ID, data = avgVEkglbmon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVEkglbm ~ bout | ID, data = avgVEkglbmon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r}
### categorical variable
flexplot(avgVEkglbm~Gender, data=avgVEkglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVEkglbm~Gender, data=avgVEkglbmoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVEkglbm~Tanner, data=avgVEkglbmon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVEkglbm~Tanner, data=avgVEkglbmoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVEkglbm~bout + intensity | Gender + Tanner, data=avgVEkglbmon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVEkglbm~bout + intensity | Gender + Tanner, data=avgVEkglbmon)
flexplot(avgVEkglbm~bout + Gender | intensity + Tanner, data=avgVEkglbmon)
flexplot(avgVEkglbm~bout + Tanner | intensity + Gender, data=avgVEkglbmon)
```


### Null Model
```{r}
nullmod <- lmer(avgVEkglbm ~ 1 + (1|ID), data = avgVEkglbmon, REML = TRUE)
(summ(nullmod) ->summnullVEkglbmon)
(BIC(nullmod) -> BICnullVEkglbmon)
(summnullVEkglbmon$gvars[,3] -> ICCnullVEkglbmon)
```
### Model 1: All interactions

```{r}
intVEkglbmon <- lmer(avgVEkglbm~  bout*intensity*Gender*Tanner +(bout|ID)  , data = avgVEkglbmon, REML=FALSE)
# summary(intVEkglbmon)
(summ(intVEkglbmon)->summintVEkglbmon)
(BIC(intVEkglbmon) -> BICintVEkglbmon)
(summintVEkglbmon$gvars[,3] -> ICCintVEkglbmon)
# coef(intVEkglbmon)
# fixef(intVEkglbmon)
# ranef(intVEkglbmon)
```

### Model 1B: Some interactions

```{r}
VEkglbmon <- lmer(avgVEkglbm~bout + Gender + Tanner*intensity +(bout|ID)  , data = avgVEkglbmon, REML=TRUE)
# summary(VEkglbmon)
# coef(VEkglbmon)
# ranef(VEkglbmon)
(summ(VEkglbmon)->summVEkglbmon)
(BIC(VEkglbmon) -> BICVEkglbmon)
(summVEkglbmon$gvars[,3] -> ICCVEkglbmon)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
VEoncoefs <- as_tibble(coef(VEkglbmon)$ID)

VEoncoefs <- tibble(demographics, VEoncoefs$bout)

write.csv(VEoncoefs,"~/R/MBEB-CPET/output/VEoncoefs.csv", row.names = TRUE)
```

## VEkglbm OFF TRANSIENT

### Null Model
```{r}
nullmod <- lmer(avgVEkglbm ~ 1 + (1|ID), data = avgVEkglbmoff, REML = TRUE)
(summ(nullmod) ->summnullVEkglbmoff)
(BIC(nullmod) -> BICnullVEkglbmoff)
(summnullVEkglbmoff$gvars[,3] -> ICCnullVEkglbmoff)
```

### Model 2: All interactions
```{r}
intVEkglbmoff <- lmer(avgVEkglbm~ bout*intensity*Gender*Tanner +(bout|ID) , data = avgVEkglbmoff, REML=FALSE)
# summary(intVEkglbmoff)
(summ(intVEkglbmoff)->summintVEkglbmoff)
(BIC(intVEkglbmoff) -> BICintVEkglbmoff)
(summintVEkglbmoff$gvars[,3] -> ICCintVEkglbmoff)
# coef(intVEkglbmoff)
# fixef(intVEkglbmoff)
# ranef(intVEkglbmoff)
```

### Model 2C: Some interactions
```{r}
VEkglbmoff <- lmer(avgVEkglbm~Gender*intensity + bout*intensity + Tanner*intensity +(bout|ID) , data = avgVEkglbmoff, REML=FALSE)
# summary(VEkglbmoff)
# coef(VEkglbmoff)
# ranef(VEkglbmoff)
(summ(VEkglbmoff)->summVEkglbmoff)
(BIC(VEkglbmoff) -> BICVEkglbmoff)
(summVEkglbmoff$gvars[,3] -> ICCVEkglbmoff)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
VEoffcoefs <- as_tibble(coef(VEkglbmoff)$ID)

VEoffcoefs <- tibble(demographics, VEoffcoefs$bout)

write.csv(VEoffcoefs,"~/R/MBEB-CPET/output/VEoffcoefs.csv", row.names = TRUE)
```

## RR On Transient
First, pull out the average on and off transient RR values for each bout.
```{r}
avgRRon <- aggregate(ontransbouts$RR, by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgRRon)[6] <- "avgRR"

avgRRoff <- aggregate(offtransbouts$RR, by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgRRoff)[6] <- "avgRR"
```

### Plot the average RR data distributions.
```{r}
#plot the avg ON-transient RR
ggplot(data=avgRRon, aes(bout, avgRR, color = intensity)) + geom_point() + ggtitle("On-Transient average RR rates")

#plot the avg off-transient RR
ggplot(data=avgRRoff, aes(bout, avgRR, color = intensity)) + geom_point()+ ggtitle("Off-Transient average RR rates")

ggplot(data=filter(avgRRon, intensity == "low"), aes(x = bout,y= avgRR, group = ID)) + geom_line() + ggtitle("Low intensity, Avg RR for on-transient periods") + ylim(0,80) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgRRoff, intensity == "low"), aes(x = bout,y= avgRR, group = ID)) + geom_line() + ggtitle("Low intensity, Avg RR for off-transient periods")+  ylim(0,80) 

ggplot(data=filter(avgRRon, intensity == "high"), aes(x = bout,y= avgRR, group = ID)) + geom_line() + ggtitle("High intensity, Avg RR for on-transient periods")  + ylim(0,80) 
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgRRoff, intensity == "high"), aes(x = bout,y= avgRR, group = ID)) + geom_line() + ggtitle("High intensity, Avg RR for off-transient periods") + ylim(0,80)  
```

### Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r}
xyplot(avgRR ~ bout | ID, data = avgRRon, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgRR ~ bout | ID, data = avgRRon, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgRR ~ bout | ID, data = avgRRon, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r}
### categorical variable
flexplot(avgRR~Gender, data=avgRRon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgRR~Gender, data=avgRRoff, spread="quartiles", jitter=c(.1, 0))

flexplot(avgRR~Tanner, data=avgRRon, spread="quartiles", jitter=c(.1, 0))
flexplot(avgRR~Tanner, data=avgRRoff, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remoRR standard errors, and specify 2 bins
flexplot(avgRR~bout + intensity | Gender + Tanner, data=avgRRon, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgRR~bout + intensity | Gender + Tanner, data=avgRRon)
flexplot(avgRR~bout + Gender | intensity + Tanner, data=avgRRon)
flexplot(avgRR~bout + Tanner | intensity + Gender, data=avgRRon)
```


### Null Model
```{r}
nullmod <- lmer(avgRR ~ 1 + (1|ID), data = avgRRon, REML = TRUE)
(summ(nullmod) ->summnullRRon)
(BIC(nullmod) -> BICnullRRon)
(summnullRRon$gvars[,3] -> ICCnullRRon)
```
### Model 1: All interactions

```{r}
intRRon <- lmer(avgRR~Gender*Tanner*bout*intensity +(bout|ID)  , data = avgRRon, REML=FALSE)
# summary(intRRon)
(summ(intRRon)->summintRRon)
(BIC(intRRon) -> BICintRRon)
(summintRRon$gvars[,3] -> ICCintRRon)
# coef(intRRon)
# fixef(intRRon)
# ranef(intRRon)
```

### Model 1C: Some interactions

```{r}
RRon <- lmer(avgRR~ bout*intensity + Tanner + Gender  + (bout|ID)  , data = avgRRon, REML=FALSE)
# summary(RRon)
# coef(RRon)
# ranef(RRon)
(summ(RRon)->summRRon)
(BIC(RRon) -> BICRRon)
(summRRon$gvars[,3] -> ICCRRon)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
RRoncoefs <- as_tibble(coef(RRon)$ID)

RRoncoefs <- tibble(demographics, RRoncoefs$bout)

write.csv(RRoncoefs,"~/R/MBEB-CPET/output/RRoncoefs.csv", row.names = TRUE)
```

## RR OFF TRANSIENT

### Null Model
```{r}
nullmod <- lmer(avgRR ~ 1 + (1|ID), data = avgRRoff, REML = TRUE)
(summ(nullmod) ->summnullRRoff)
(BIC(nullmod) -> BICnullRRoff)
(summnullRRoff$gvars[,3] -> ICCnullRRoff)
```

### Model 2: All interactions

```{r}
intRRoff <- lmer(avgRR~Gender*Tanner*bout*intensity +(bout|ID) , data = avgRRoff, REML=FALSE)
# summary(intRRoff)
(summ(intRRoff)->summintRRoff)
(BIC(intRRoff) -> BICintRRoff)
(summintRRoff$gvars[,3] -> ICCintRRoff)
# coef(intRRoff)
# fixef(intRRoff)
# ranef(intRRoff)
```

### Model 2B: Some interactions
```{r}
RRoff <- lmer(avgRR~ bout*intensity + Gender*Tanner*bout + (bout|ID) , data = avgRRoff, REML=FALSE)
# summary(RRoff)
# coef(RRoff)
# ranef(RRoff)
(summ(RRoff)->summRRoff)
(BIC(RRoff) -> BICRRoff)
(summRRoff$gvars[,3] -> ICCRRoff)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
RRoffcoefs <- as_tibble(coef(RRoff)$ID)

RRoffcoefs <- tibble(demographics, RRoffcoefs$bout)

write.csv(RRoffcoefs,"~/R/MBEB-CPET/output/RRoffcoefs.csv", row.names = TRUE)
```

## VE.VCO2 On Transient

First, pull out the average on and off transient VE.VCO2 values for each bout.
```{r}
avgVE.VCO2on <- aggregate(ontransbouts$'VE/VCO2', by=list(bout=ontransbouts$bout, ID = ontransbouts$ID, intensity = ontransbouts$intensity, Gender=ontransbouts$Gender, Tanner=ontransbouts$Tanner), FUN=mean) 
names(avgVE.VCO2on)[6] <- "avgVE.VCO2"

avgVE.VCO2off <- aggregate(offtransbouts$'VE/VCO2', by=list(bout=offtransbouts$bout, ID = offtransbouts$ID, intensity = offtransbouts$intensity, Gender=offtransbouts$Gender, Tanner=offtransbouts$Tanner), FUN=mean)
names(avgVE.VCO2off)[6] <- "avgVE.VCO2"
```

### Plot the average VE/VCO2 data distributions.
```{r}
#plot the avg ON-transient VE/VCO2
ggplot(data=avgVE.VCO2on, aes(bout, avgVE.VCO2, color = intensity)) + geom_point() + ggtitle("On-Transient average VE/VCO2 rates")

#plot the avg off-transient VE/VCO2
ggplot(data=avgVE.VCO2off, aes(bout, avgVE.VCO2, color = intensity)) + geom_point()+ ggtitle("Off-Transient average VE/VCO2 rates")

ggplot(data=filter(avgVE.VCO2on, intensity == "low"), aes(x = bout,y= avgVE.VCO2, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VE/VCO2 for on-transient periods")+ ylim(20,80)
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVE.VCO2off, intensity == "low"), aes(x = bout,y= avgVE.VCO2, group = ID)) + geom_line() + ggtitle("Low intensity, Avg VE/VCO2 for off-transient periods")+ ylim(20,80)

ggplot(data=filter(avgVE.VCO2on, intensity == "high"), aes(x = bout,y= avgVE.VCO2, group = ID)) + geom_line() + ggtitle("High intensity, Avg VE/VCO2 for on-transient periods")+ ylim(20,80)
# + geom_abline(intercept = 139, slope=7.6,color = "red", linetype="dashed", size = 1.7)

ggplot(data=filter(avgVE.VCO2off, intensity == "high"), aes(x = bout,y= avgVE.VCO2, group = ID)) + geom_line() + ggtitle("High intensity, Avg VE/VCO2 for off-transient periods") + ylim(20,80)
```

### Show xyplots to compare the slopes for each individual based on Gender, Tanner score, intensity
```{r}
xyplot(avgVE.VCO2 ~ bout | ID, data = avgVE.VCO2on, groups = Gender, type = c("p","r"), auto.key = TRUE)

xyplot(avgVE.VCO2 ~ bout | ID, data = avgVE.VCO2on, groups = Tanner, type = c("p","r"), auto.key = TRUE)

xyplot(avgVE.VCO2 ~ bout | ID, data = avgVE.VCO2on, groups = intensity, type = c("p","r"), auto.key = TRUE)
```

### More visualizations
```{r}
### categorical variable
flexplot(avgVE.VCO2~Gender, data=avgVE.VCO2on, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVE.VCO2~Gender, data=avgVE.VCO2off, spread="quartiles", jitter=c(.1, 0))

flexplot(avgVE.VCO2~Tanner, data=avgVE.VCO2on, spread="quartiles", jitter=c(.1, 0))
flexplot(avgVE.VCO2~Tanner, data=avgVE.VCO2off, spread="quartiles", jitter=c(.1, 0))

### show a straight line, remove standard errors, and specify 2 bins
flexplot(avgVE.VCO2~bout + intensity | Gender + Tanner, data=avgVE.VCO2on, method="lm", se=F, bins=2)

### multivariate relationship
flexplot(avgVE.VCO2~bout + intensity | Gender + Tanner, data=avgVE.VCO2on)
flexplot(avgVE.VCO2~bout + Gender | intensity + Tanner, data=avgVE.VCO2on)
flexplot(avgVE.VCO2~bout + Tanner | intensity + Gender, data=avgVE.VCO2on)
```


### Null Model
```{r}
nullmod <- lmer(avgVE.VCO2 ~ 1 + (1|ID), data = avgVE.VCO2on, REML = TRUE)
(summ(nullmod) ->summnullVE.VCO2on)
(BIC(nullmod) -> BICnullVE.VCO2on)
(summnullVE.VCO2on$gvars[,3] -> ICCnullVE.VCO2on)
```
### Model 1: All interactions

```{r}
intVE.VCO2on <- lmer(avgVE.VCO2~Gender*Tanner*bout*intensity +(bout|ID)  , data = avgVE.VCO2on, REML=FALSE)
# summary(intVE.VCO2on)
(summ(intVE.VCO2on)->summintVE.VCO2on)
(BIC(intVE.VCO2on) -> BICintVE.VCO2on)
(summintVE.VCO2on$gvars[,3] -> ICCintVE.VCO2on)
# coef(intVE.VCO2on)
# fixef(intVE.VCO2on)
# ranef(intVE.VCO2on)
```

### Model 1C: Some interactions
```{r}
VE.VCO2on <- lmer(avgVE.VCO2~ bout*intensity + Tanner*intensity + Gender  + (bout|ID)  , data = avgVE.VCO2on, REML=FALSE)
# summary(VE.VCO2on)
# coef(VE.VCO2on)
# ranef(VE.VCO2on)
(summ(VE.VCO2on)->summVE.VCO2on)
(BIC(VE.VCO2on) -> BICVE.VCO2on)
(summVE.VCO2on$gvars[,3] -> ICCVE.VCO2on)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
VE.VCO2oncoefs <- as_tibble(coef(VE.VCO2on)$ID)

VE.VCO2oncoefs <- tibble(demographics, VE.VCO2oncoefs$bout)

write.csv(VE.VCO2oncoefs,"~/R/MBEB-CPET/output/VE.VCO2oncoefs.csv", row.names = TRUE)
```

## VE.VCO2 OFF TRANSIENT

### Null Model
```{r}
nullmod <- lmer(avgVE.VCO2 ~ 1 + (1|ID), data = avgVE.VCO2off, REML = TRUE)
(summ(nullmod) ->summnullVE.VCO2off)
(BIC(nullmod) -> BICnullVE.VCO2off)
(summnullVE.VCO2off$gvars[,3] -> ICCnullVE.VCO2off)
```

### Model 2: All interactions

```{r}
intVE.VCO2off <- lmer(avgVE.VCO2~Gender*Tanner*bout*intensity +(bout|ID) , data = avgVE.VCO2off, REML=FALSE)
# summary(intVE.VCO2off)
(summ(intVE.VCO2off)->summintVE.VCO2off)
(BIC(intVE.VCO2off) -> BICintVE.VCO2off)
(summintVE.VCO2off$gvars[,3] -> ICCintVE.VCO2off)
# coef(intVE.VCO2off)
# fixef(intVE.VCO2off)
# ranef(intVE.VCO2off)
```

### Model 2C: Some interactions
```{r}
VE.VCO2off <- lmer(avgVE.VCO2~ bout + Gender + Tanner* intensity + (bout|ID) , data = avgVE.VCO2off, REML=TRUE)
# summary(VE.VCO2off)
# coef(VE.VCO2off)
# ranef(VE.VCO2off)
(summ(VE.VCO2off)->summVE.VCO2off)
(BIC(VE.VCO2off) -> BICVE.VCO2off)
(summVE.VCO2off$gvars[,3] -> ICCVE.VCO2off)
```

### Create a tibble of model coefficients by ID.
This generates a table of individualized coefficients for each subject, which includes fixed effects + random effects. These will be used for analysis of group averages.

```{r}
VE.VCO2offcoefs <- as_tibble(coef(VE.VCO2off)$ID)

VE.VCO2offcoefs <- tibble(demographics, VE.VCO2offcoefs$bout)

write.csv(VE.VCO2offcoefs,"~/R/MBEB-CPET/output/VE.VCO2offcoefs.csv", row.names = TRUE)
```

# Predicted Values

## Predict and visualize the linear models.

https://strengejacke.github.io/ggeffects/articles/introduction_randomeffects.html

When type = "random", the predicted values are still on the population-level. However, the random effect variances are taken into account, meaning that the intervals are actually prediction intervals and become larger. More technically speaking, type = "random" accounts for the uncertainty of the fixed effects conditional on the estimates of the random-effect variances and conditional modes (BLUPs).

The random-effect variance is the mean random-effect variance. Calculation is based on the proposal from Johnson et al. 2014, which is also implemented in functions like performance::r2() or insight::get_variance() to get r-squared values or random effect variances for mixed models with more complex random effects structures.

As can be seen, compared to the previous example with type = "fixed", predicted values are identical (both on the population-level). However, standard errors, and thus the resulting confidence (or prediction) intervals are much larger .

```{r}
# Another way to do this is with plot_model:  
# plot_model(HRon, type = "pred", terms = c("bout[1,2,3,4,5]", "Tanner", "intensity"))

dat.HRon <- ggpredict(HRon, terms = c("bout[1,2,3,4,5]","Gender","Tanner","intensity"), type = "random")
plot(dat.HRon, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")
write.csv(dat.HRon,"~/R/MBEB-CPET/output/dat.HRon.csv", row.names = FALSE)

dat.HRoff <- ggpredict(HRoff, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.HRoff,"~/R/MBEB-CPET/output/dat.HRoff.csv", row.names = FALSE)
plot(dat.HRoff, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.VO2KGLBMon <- ggpredict(VO2KGLBMon, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.VO2KGLBMon,"~/R/MBEB-CPET/output/dat.VO2KGLBMon.csv", row.names = FALSE)
plot(dat.VO2KGLBMon, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.VO2KGLBMoff <- ggpredict(VO2KGLBMoff, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.VO2KGLBMoff,"~/R/MBEB-CPET/output/dat.VO2KGLBMoff.csv", row.names = FALSE)
plot(dat.VO2KGLBMoff, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.VCO2kglbmon <- ggpredict(VCO2kglbmon, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.VCO2kglbmon,"~/R/MBEB-CPET/output/dat.VCO2kglbmon.csv", row.names = FALSE)
plot(dat.VCO2kglbmon, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.VCO2kglbmoff <- ggpredict(VCO2kglbmoff, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.VCO2kglbmoff,"~/R/MBEB-CPET/output/dat.VCO2kglbmoff.csv", row.names = FALSE)
plot(dat.VCO2kglbmoff, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.RQon <- ggpredict(RQon, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.RQon,"~/R/MBEB-CPET/output/dat.RQon.csv", row.names = FALSE)
plot(dat.RQon, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.RQoff <- ggpredict(RQoff, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.RQoff,"~/R/MBEB-CPET/output/dat.RQoff.csv", row.names = FALSE)
plot(dat.RQoff, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.VEkglbmon <- ggpredict(VEkglbmon, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.VEkglbmon,"~/R/MBEB-CPET/output/dat.VEkglbmon.csv", row.names = FALSE)
plot(dat.VEkglbmon, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.VEkglbmoff <- ggpredict(VEkglbmoff, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.VEkglbmoff,"~/R/MBEB-CPET/output/dat.VEkglbmoff.csv", row.names = FALSE)
plot(dat.VEkglbmoff, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.RRon <- ggpredict(RRon, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.RRon,"~/R/MBEB-CPET/output/dat.RRon.csv", row.names = FALSE)
plot(dat.RRon, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.RRoff <- ggpredict(RRoff, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.RRoff,"~/R/MBEB-CPET/output/dat.RRoff.csv", row.names = FALSE)
plot(dat.RRoff, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.VE.VCO2on <- ggpredict(VE.VCO2on, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.VE.VCO2on,"~/R/MBEB-CPET/output/dat.VE.VCO2on.csv", row.names = FALSE)
plot(dat.VE.VCO2on, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")

dat.VE.VCO2off <- ggpredict(VE.VCO2off, terms = c("bout[1,2,3,4,5]","Gender", "Tanner", "intensity"))
write.csv(dat.VE.VCO2off,"~/R/MBEB-CPET/output/dat.VE.VCO2off.csv", row.names = FALSE)
plot(dat.VE.VCO2off, ci.style = "dot", add.data = TRUE, use.theme = T, connect.lines = T,residuals = TRUE, residuals.line = FALSE, dot.alpha = 0.5, dot.size = 3, jitter = NULL, collapse.group = "intensity")
```

## Individual prediction plots

To produce plots of the estimated marginal means (from the model) compared to the raw data at each combination of levels:

### HRon
```{r}
CPET <- 'HRon'
```

MALES
```{r}
grouping <-  'MEH'

#raw data of MEH
MEH <- filter(avgHRon, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(HRon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgHR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean HR: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MEL'

#raw data of MEL
MEL <- filter(avgHRon, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(HRon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgHR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean HR: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLL'

#raw data of MLL
MLL <- filter(avgHRon, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(HRon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgHR'


#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean HR: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLH'

#raw data of MLH
MLH <- filter(avgHRon, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(HRon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean HR: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
grouping <-  'FEH'

#raw data of FEH
FEH <- filter(avgHRon, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(HRon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgHR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean HR: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FEL'

#raw data of FEL
FEL <- filter(avgHRon, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(HRon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgHR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean HR: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLL'

#raw data of FLL
FLL <- filter(avgHRon, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(HRon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean HR: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLH'

#raw data of FLH
FLH <- filter(avgHRon, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(HRon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean HR: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### HRoff
```{r}
CPET <- 'HRoff'
```

MALES
```{r}
#raw data of MEH
MEH <- filter(avgHRoff, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(HRoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgHR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean HR: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MEL
MEL <- filter(avgHRoff, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(HRoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgHR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean HR: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLL
MLL <- filter(avgHRoff, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(HRoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean HR: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLH
MLH <- filter(avgHRoff, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(HRoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean HR: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
#raw data of FEH
FEH <- filter(avgHRoff, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(HRoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgHR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean HR: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FEL
FEL <- filter(avgHRoff, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(HRoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgHR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean HR: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLL
FLL <- filter(avgHRoff, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(HRoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean HR: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLH
FLH <- filter(avgHRoff, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(HRoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgHR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgHR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgHR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgHR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean HR: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### VO2/kg on
```{r}
CPET <- 'VO2kg'
```

MALES
```{r}
grouping <- "MEH"

#raw data of MEH
MEH <- filter(avgVO2kglbmon, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(VO2KGLBMon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "MEL"

#raw data of MEL
MEL <- filter(avgVO2kglbmon, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(VO2KGLBMon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "MLL"

#raw data of MLL
MLL <- filter(avgVO2kglbmon, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(VO2KGLBMon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "MLH"

#raw data of MLH
MLH <- filter(avgVO2kglbmon, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(VO2KGLBMon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
grouping <- "FEH"

#raw data of FEH
FEH <- filter(avgVO2kglbmon, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(VO2KGLBMon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "FEL"

#raw data of FEL
FEL <- filter(avgVO2kglbmon, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(VO2KGLBMon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "FLL"

#raw data of FLL
FLL <- filter(avgVO2kglbmon, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(VO2KGLBMon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "FLH"
#raw data of FLH
FLH <- filter(avgVO2kglbmon, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(VO2KGLBMon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### VO2/kg off
```{r}
CPET <- 'VO2kg'
```

MALES
```{r}
grouping <- "MEH"

#raw data of MEH
MEH <- filter(avgVO2kglbmoff, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(VO2KGLBMoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "MEL"

#raw data of MEL
MEL <- filter(avgVO2kglbmoff, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(VO2KGLBMoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "MLL"

#raw data of MLL
MLL <- filter(avgVO2kglbmoff, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(VO2KGLBMoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "MLH"

#raw data of MLH
MLH <- filter(avgVO2kglbmoff, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(VO2KGLBMoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
grouping <- "FEH"

#raw data of FEH
FEH <- filter(avgVO2kglbmoff, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(VO2KGLBMoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "FEL"

#raw data of FEL
FEL <- filter(avgVO2kglbmoff, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(VO2KGLBMoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "FLL"

#raw data of FLL
FLL <- filter(avgVO2kglbmoff, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(VO2KGLBMoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <- "FLH"
#raw data of FLH
FLH <- filter(avgVO2kglbmoff, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(VO2KGLBMoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgVO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VO2/kg Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```







```{r Plot the fixed effects estimates}
# Currently not used for this analysis.

# plot_summs(VCO2on, VCO2off, scale = TRUE, 
#            # inner_ci_level = .95, 
#            plot.distributions = F)
```


### VCO2/kg on
```{r}
CPET <- 'VCO2on'
```

MALES
```{r}
grouping <-  'MEH'

#raw data of MEH
MEH <- filter(avgVCO2kglbmon, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(VCO2kglbmon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVCO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VCO2kglbm: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MEL'

#raw data of MEL
MEL <- filter(avgVCO2kglbmon, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(VCO2kglbmon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVCO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VCO2kglbm: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLL'

#raw data of MLL
MLL <- filter(avgVCO2kglbmon, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(VCO2kglbmon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgVCO2kglbm'


#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VCO2kglbm: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLH'

#raw data of MLH
MLH <- filter(avgVCO2kglbmon, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(VCO2kglbmon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VCO2kglbm: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
grouping <-  'FEH'

#raw data of FEH
FEH <- filter(avgVCO2kglbmon, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(VCO2kglbmon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVCO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VCO2kglbm: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FEL'

#raw data of FEL
FEL <- filter(avgVCO2kglbmon, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(VCO2kglbmon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVCO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VCO2kglbm: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLL'

#raw data of FLL
FLL <- filter(avgVCO2kglbmon, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(VCO2kglbmon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VCO2kglbm: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLH'

#raw data of FLH
FLH <- filter(avgVCO2kglbmon, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(VCO2kglbmon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VCO2kglbm: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### VCO2/kg off
```{r}
CPET <- 'VCO2off'
```

MALES
```{r}
#raw data of MEH
MEH <- filter(avgVCO2kglbmoff, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(VCO2kglbmoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVCO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VCO2kglbm: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MEL
MEL <- filter(avgVCO2kglbmoff, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(VCO2kglbmoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVCO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VCO2kglbm: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLL
MLL <- filter(avgVCO2kglbmoff, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(VCO2kglbmoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VCO2kglbm: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLH
MLH <- filter(avgVCO2kglbmoff, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(VCO2kglbmoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VCO2kglbm: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
#raw data of FEH
FEH <- filter(avgVCO2kglbmoff, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(VCO2kglbmoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVCO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VCO2kglbm: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FEL
FEL <- filter(avgVCO2kglbmoff, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(VCO2kglbmoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVCO2kglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VCO2kglbm: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLL
FLL <- filter(avgVCO2kglbmoff, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(VCO2kglbmoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VCO2kglbm: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLH
FLH <- filter(avgVCO2kglbmoff, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(VCO2kglbmoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgVCO2kglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVCO2kglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVCO2kglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VCO2kglbm: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### RQon
```{r}
CPET <- 'RQon'
```

MALES
```{r}
grouping <-  'MEH'

#raw data of MEH
MEH <- filter(avgRQon, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(RQon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgRQ, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RQ: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MEL'

#raw data of MEL
MEL <- filter(avgRQon, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(RQon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgRQ, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RQ: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLL'

#raw data of MLL
MLL <- filter(avgRQon, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(RQon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgRQ'


#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RQ: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLH'

#raw data of MLH
MLH <- filter(avgRQon, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(RQon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RQ: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
grouping <-  'FEH'

#raw data of FEH
FEH <- filter(avgRQon, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(RQon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgRQ, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RQ: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FEL'

#raw data of FEL
FEL <- filter(avgRQon, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(RQon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgRQ, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RQ: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLL'

#raw data of FLL
FLL <- filter(avgRQon, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(RQon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RQ: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLH'

#raw data of FLH
FLH <- filter(avgRQon, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(RQon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RQ: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### RQoff
```{r}
CPET <- 'RQoff'
```

MALES
```{r}
#raw data of MEH
MEH <- filter(avgRQoff, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(RQoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgRQ, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RQ: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MEL
MEL <- filter(avgRQoff, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(RQoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgRQ, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RQ: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLL
MLL <- filter(avgRQoff, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(RQoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RQ: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLH
MLH <- filter(avgRQoff, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(RQoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RQ: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
#raw data of FEH
FEH <- filter(avgRQoff, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(RQoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgRQ, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RQ: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FEL
FEL <- filter(avgRQoff, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(RQoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgRQ, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RQ: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLL
FLL <- filter(avgRQoff, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(RQoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RQ: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLH
FLH <- filter(avgRQoff, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(RQoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgRQ'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgRQ, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRQ, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RQ: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### VEon
```{r}
CPET <- 'VEon'
```

MALES
```{r}
grouping <-  'MEH'

#raw data of MEH
MEH <- filter(avgVEkglbmon, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(VEkglbmon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVEkglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VEkglbm: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MEL'

#raw data of MEL
MEL <- filter(avgVEkglbmon, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(VEkglbmon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVEkglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VEkglbm: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLL'

#raw data of MLL
MLL <- filter(avgVEkglbmon, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(VEkglbmon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgVEkglbm'


#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VEkglbm: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLH'

#raw data of MLH
MLH <- filter(avgVEkglbmon, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(VEkglbmon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VEkglbm: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
grouping <-  'FEH'

#raw data of FEH
FEH <- filter(avgVEkglbmon, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(VEkglbmon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVEkglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VEkglbm: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FEL'

#raw data of FEL
FEL <- filter(avgVEkglbmon, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(VEkglbmon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVEkglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VEkglbm: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLL'

#raw data of FLL
FLL <- filter(avgVEkglbmon, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(VEkglbmon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VEkglbm: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLH'

#raw data of FLH
FLH <- filter(avgVEkglbmon, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(VEkglbmon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VEkglbm: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### VEoff
```{r}
CPET <- 'VEoff'
```

MALES
```{r}
#raw data of MEH
MEH <- filter(avgVEkglbmoff, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(VEkglbmoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVEkglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VEkglbm: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MEL
MEL <- filter(avgVEkglbmoff, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(VEkglbmoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVEkglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VEkglbm: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLL
MLL <- filter(avgVEkglbmoff, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(VEkglbmoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VEkglbm: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLH
MLH <- filter(avgVEkglbmoff, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(VEkglbmoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VEkglbm: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
#raw data of FEH
FEH <- filter(avgVEkglbmoff, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(VEkglbmoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVEkglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VEkglbm: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FEL
FEL <- filter(avgVEkglbmoff, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(VEkglbmoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVEkglbm, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VEkglbm: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLL
FLL <- filter(avgVEkglbmoff, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(VEkglbmoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VEkglbm: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLH
FLH <- filter(avgVEkglbmoff, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(VEkglbmoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgVEkglbm'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVEkglbm, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVEkglbm, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VEkglbm: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### RRon
```{r}
CPET <- 'RRon'
```

MALES
```{r}
grouping <-  'MEH'

#raw data of MEH
MEH <- filter(avgRRon, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(RRon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgRR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RR: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MEL'

#raw data of MEL
MEL <- filter(avgRRon, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(RRon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgRR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RR: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLL'

#raw data of MLL
MLL <- filter(avgRRon, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(RRon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgRR'


#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RR: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLH'

#raw data of MLH
MLH <- filter(avgRRon, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(RRon, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RR: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
grouping <-  'FEH'

#raw data of FEH
FEH <- filter(avgRRon, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(RRon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgRR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RR: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FEL'

#raw data of FEL
FEL <- filter(avgRRon, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(RRon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgRR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RR: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLL'

#raw data of FLL
FLL <- filter(avgRRon, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(RRon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RR: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLH'

#raw data of FLH
FLH <- filter(avgRRon, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(RRon, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean RR: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### RRoff
```{r}
CPET <- 'RRoff'
```

MALES
```{r}
#raw data of MEH
MEH <- filter(avgRRoff, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(RRoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgRR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RR: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MEL
MEL <- filter(avgRRoff, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(RRoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgRR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RR: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLL
MLL <- filter(avgRRoff, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(RRoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RR: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLH
MLH <- filter(avgRRoff, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(RRoff, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RR: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
#raw data of FEH
FEH <- filter(avgRRoff, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(RRoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgRR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RR: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FEL
FEL <- filter(avgRRoff, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(RRoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgRR, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RR: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLL
FLL <- filter(avgRRoff, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(RRoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RR: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLH
FLH <- filter(avgRRoff, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(RRoff, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgRR'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgRR, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgRR, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgRR, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean RR: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### VE.VCO2on
```{r}
CPET <- 'VE.VCO2on'
```

MALES
```{r}
grouping <-  'MEH'

#raw data of MEH
MEH <- filter(avgVE.VCO2on, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(VE.VCO2on, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVE.VCO2, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VE.VCO2: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MEL'

#raw data of MEL
MEL <- filter(avgVE.VCO2on, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(VE.VCO2on, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVE.VCO2, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VE.VCO2: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLL'

#raw data of MLL
MLL <- filter(avgVE.VCO2on, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(VE.VCO2on, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgVE.VCO2'


#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VE.VCO2: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'MLH'

#raw data of MLH
MLH <- filter(avgVE.VCO2on, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(VE.VCO2on, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VE.VCO2: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
grouping <-  'FEH'

#raw data of FEH
FEH <- filter(avgVE.VCO2on, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(VE.VCO2on, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVE.VCO2, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VE.VCO2: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FEL'

#raw data of FEL
FEL <- filter(avgVE.VCO2on, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(VE.VCO2on, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVE.VCO2, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VE.VCO2: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLL'

#raw data of FLL
FLL <- filter(avgVE.VCO2on, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(VE.VCO2on, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VE.VCO2: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
grouping <-  'FLH'

#raw data of FLH
FLH <- filter(avgVE.VCO2on, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(VE.VCO2on, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("On-Transient Mean VE.VCO2: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

### VE.VCO2off
```{r}
CPET <- 'VE.VCO2off'
```

MALES
```{r}
#raw data of MEH
MEH <- filter(avgVE.VCO2off, Gender == "MALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MEH
dat.MEH <- as.data.frame(ggpredict(VE.VCO2off, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.MEH)[1] <- 'bout'
names(dat.MEH)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEH) + 
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVE.VCO2, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VE.VCO2: Early Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MEL
MEL <- filter(avgVE.VCO2off, Gender == "MALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MEL
dat.MEL <- as.data.frame(ggpredict(VE.VCO2off, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.MEL)[1] <- 'bout'
names(dat.MEL)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MEL) + 
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MEL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = MEH, aes(x = bout, y = avgVE.VCO2, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VE.VCO2: Early Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLL
MLL <- filter(avgVE.VCO2off, Gender == "MALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of MLL
dat.MLL <- as.data.frame(ggpredict(VE.VCO2off, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.MLL)[1] <- 'bout'
names(dat.MLL)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLL) + 
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VE.VCO2: Late Puberty Male, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of MLH
MLH <- filter(avgVE.VCO2off, Gender == "MALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of MLH
dat.MLH <- as.data.frame(ggpredict(VE.VCO2off, terms = c("bout[1,2,3,4,5]","Gender[MALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.MLH)[1] <- 'bout'
names(dat.MLH)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.MLH) + 
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = MLH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VE.VCO2: Late Puberty Male, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```

FEMALES
```{r}
#raw data of FEH
FEH <- filter(avgVE.VCO2off, Gender == "FEMALE", Tanner == "Early", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FEH
dat.FEH <- as.data.frame(ggpredict(VE.VCO2off, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[high]"), type = "random"))
names(dat.FEH)[1] <- 'bout'
names(dat.FEH)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEH) + 
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVE.VCO2, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VE.VCO2: Early Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FEL
FEL <- filter(avgVE.VCO2off, Gender == "FEMALE", Tanner == "Early", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FEL
dat.FEL <- as.data.frame(ggpredict(VE.VCO2off, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Early]","intensity[low]"), type = "random"))
names(dat.FEL)[1] <- 'bout'
names(dat.FEL)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FEL) + 
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FEL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  # geom_point(data = FEH, aes(x = bout, y = avgVE.VCO2, color = 'black'), alpha = 0.5) +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VE.VCO2: Early Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLL
FLL <- filter(avgVE.VCO2off, Gender == "FEMALE", Tanner == "Late", intensity == "low", bout %in% c(1,2,3,4,5))

#emmeans of FLL
dat.FLL <- as.data.frame(ggpredict(VE.VCO2off, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[low]"), type = "random"))
names(dat.FLL)[1] <- 'bout'
names(dat.FLL)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLL) + 
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLL, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VE.VCO2: Late Puberty FEMALE, Low intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```
```{r}
#raw data of FLH
FLH <- filter(avgVE.VCO2off, Gender == "FEMALE", Tanner == "Late", intensity == "high", bout %in% c(1,2,3,4,5))

#emmeans of FLH
dat.FLH <- as.data.frame(ggpredict(VE.VCO2off, terms = c("bout[1,2,3,4,5]","Gender[FEMALE]","Tanner[Late]","intensity[high]"), type = "random"))
names(dat.FLH)[1] <- 'bout'
names(dat.FLH)[2] <- 'avgVE.VCO2'

#save the plot
jpeg(file= here("output/meanplots",paste0(CPET,grouping,"means",".jpeg"))
       , width = 800, height = 500)

ggplot(data = dat.FLH) + 
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun = mean, geom = "point")+
  stat_summary(data = FLH, mapping = aes(x = bout, y = avgVE.VCO2, color = "black"), fun.data = mean_se, geom = "errorbar") +
  geom_point(mapping = aes(x = bout, y = avgVE.VCO2, color = 'red'), pch = 1, size = 4) +
  theme_bw() + 
  ggtitle("Off-Transient Mean VE.VCO2: Late Puberty FEMALE, High intensity") +
  scale_colour_manual(name = "data", values = c('red'='red', 'black'='black'),labels =c('Raw Data (Std Error)','Est Marginal Mean'))

dev.off()
```


# Printing the model results as tables
## Tab_model version

 Adjust file name in the tab_model function to specify html save location.
```{r}
allmodels <- c(HRon, HRoff, VO2KGLBMon,VO2KGLBMoff, VCO2kglbmon,VCO2kglbmoff,RQon,RQoff,VEkglbmon,VEkglbmoff,RRon,RRoff,VE.VCO2on, VE.VCO2off)

tab_model(allmodels, 
          show.reflvl = F, 
          auto.label=TRUE, 
          show.fstat = TRUE,
          dv.labels = c("HR (on)", "HR (off)", "VO2/kg (on)", "VO2/kg (off)", "VCO2/kg (on)", "VCO2/kg (off)", "RQ (on)", "RQ (off)", "VE/kg (on)", "VE/kg (off)", "RR (on)", "RR (off)", "VE/VCO2 (on)", "VE/VCO2 (off)"),
          CSS = css_theme("cells")
          # ,file = "C:/Users/__.html"
          )
```

## Individual tab_models
```{r}
HRmodels <- c(HRon, HRoff)
tab_model(HRmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("HR (exercise)", "HR (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/HRmodels.html"
          )

# VO2KGmodels <- c(VO2KGon, VO2KGoff)
# tab_model(VO2KGmodels, show.reflvl = F, auto.label=TRUE 
#           # ,prefix.labels ="varname"
#           , dv.labels = c("VO2/kg (exercise)", "VO2/kg (rest)")
#           , CSS = css_theme("cells")
#           ,file = "~/R/MBEB-CPET/output/HRmodels.html"
#           )

VO2KGLBMmodels <- c(VO2KGLBMon, VO2KGLBMoff)
tab_model(VO2KGLBMmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("VO2/kg (exercise)", "VO2/kg (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/VO2models.html"
          )

# VCO2models <- c(VCO2on, VCO2off)
# tab_model(VCO2models, show.reflvl = F, auto.label=TRUE 
#           # ,prefix.labels ="varname"
#           , dv.labels = c("VCO2 (exercise)", "VCO2 (rest)")
#           , CSS = css_theme("cells")
#           ,file = "~/R/MBEB-CPET/output/HRmodels.html"
#           )

VCO2kglbmmodels <- c(VCO2kglbmon, VCO2kglbmoff)
tab_model(VCO2kglbmmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("VCO2/kg (exercise)", "VCO2/kg (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/VCO2models.html"
          )

RQmodels <- c(RQon, RQoff)
tab_model(RQmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("RQ (exercise)", "RQ (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/RQmodels.html"
          )

# VEmodels <- c(VEon, VEoff)
# tab_model(VEmodels, show.reflvl = F, auto.label=TRUE 
#           # ,prefix.labels ="varname"
#           , dv.labels = c("VE (exercise)", "VE (rest)")
#           , CSS = css_theme("cells")
#           ,file = "~/R/MBEB-CPET/output/VEmodels.html"
#           )

VEkglbmmodels <- c(VEkglbmon, VEkglbmoff)
tab_model(VEkglbmmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("VE/kg (exercise)", "VE/kg (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/VEmodels.html"
          )

RRmodels <- c(RRon, RRoff)
tab_model(RRmodels, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("RR (exercise)", "RR (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/RRmodels.html"
          )

VE.VCO2models <- c(VE.VCO2on, VE.VCO2off)
tab_model(VE.VCO2models, show.reflvl = F, auto.label=TRUE 
          # ,prefix.labels ="varname"
          , dv.labels = c("VE/VCO2 (exercise)", "VE/VCO2 (rest)")
          , CSS = css_theme("cells")
          ,file = "~/R/MBEB-CPET/output/VE.VCO2models.html"
          )
```

# Residuals analysis
Three plots can be generated:

1. A histogram of the residuals for each model against its original data.

2. Distribution of the residuals for the random effect of â€˜boutâ€™ in the model. Measure of the conditional variance.

3. A scatterplot of the residuals. Indicates normal distribution.

```{r}
HRonresiduals <- resid(HRon)
summary(HRonresiduals) #a summary of the residuals for this model
hist(HRonresiduals) # a histogram of the residuals distribution
print(dotplot(ranef(HRon,condVar=TRUE))) # a dotplot of the random effects residuals
plot(HRon) # a scatter plot of the residuals
```
```{r}
HRoffresiduals <- resid(HRoff)
summary(HRoffresiduals)
hist(HRoffresiduals)
print(dotplot(ranef(HRoff,condVar=TRUE)))
plot(HRoff)
```
```{r}
VO2KGLBMonresiduals <- resid(VO2KGLBMon)
summary(VO2KGLBMonresiduals)
hist(VO2KGLBMonresiduals)
print(dotplot(ranef(VO2KGLBMon,condVar=TRUE)))
plot(VO2KGLBMon)
```
```{r}
VO2KGLBMoffresiduals <- resid(VO2KGLBMoff)
summary(VO2KGLBMoffresiduals)
hist(VO2KGLBMoffresiduals)
print(dotplot(ranef(VO2KGLBMoff,condVar=TRUE)))
plot(VO2KGLBMoff)
```
```{r}
VCO2kglbmonresiduals <- resid(VCO2kglbmon)
summary(VCO2kglbmonresiduals)
hist(VCO2kglbmonresiduals)
print(dotplot(ranef(VCO2kglbmon,condVar=TRUE)))
plot(VCO2kglbmon)
```
```{r}
VCO2kglbmoffresiduals <- resid(VCO2kglbmoff)
summary(VCO2kglbmoffresiduals)
hist(VCO2kglbmoffresiduals)
print(dotplot(ranef(VCO2kglbmoff,condVar=TRUE)))
plot(VCO2kglbmoff)
```
```{r}
VEkglbmonresiduals <- resid(VEkglbmon)
summary(VEkglbmonresiduals)
hist(VEkglbmonresiduals)
print(dotplot(ranef(VEkglbmon,condVar=TRUE)))
plot(VEkglbmon)
```
```{r}
VEkglbmoffresiduals <- resid(VEkglbmoff)
summary(VEkglbmoffresiduals)
hist(VEkglbmoffresiduals)
print(dotplot(ranef(VEkglbmoff,condVar=TRUE)))
plot(VEkglbmoff)
```
```{r}
RQonresiduals <- resid(RQon)
summary(RQonresiduals)
hist(RQonresiduals)
print(dotplot(ranef(RQon,condVar=TRUE)))
plot(RQon)
```
```{r}
RQoffresiduals <- resid(RQoff)
summary(RQoffresiduals)
hist(RQoffresiduals)
print(dotplot(ranef(RQoff,condVar=TRUE)))
plot(RQoff)
```
```{r}
RRonresiduals <- resid(RRon)
summary(RRonresiduals)
hist(RRonresiduals)
print(dotplot(ranef(RRon,condVar=TRUE)))
plot(RRon)
```
```{r}
RRoffresiduals <- resid(RRoff)
summary(RRoffresiduals)
hist(RRoffresiduals)
print(dotplot(ranef(RRoff,condVar=TRUE)))
plot(RRoff)
```
```{r}
VE.VCO2onresiduals <- resid(VE.VCO2on)
summary(VE.VCO2onresiduals)
hist(VE.VCO2onresiduals)
print(dotplot(ranef(VE.VCO2on,condVar=TRUE)))
plot(VE.VCO2on)
```
```{r}
VE.VCO2offresiduals <- resid(VE.VCO2off)
plot(resid(VE.VCO2off))
summary(VE.VCO2offresiduals)
hist(VE.VCO2offresiduals)
print(dotplot(ranef(VE.VCO2off,condVar=TRUE)))
plot(VE.VCO2off)
```
